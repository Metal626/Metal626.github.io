<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="子质’s Notes" type="application/atom+xml" />






<meta name="description" content="Learning is a gift , even when pain is your teacher.">
<meta property="og:type" content="website">
<meta property="og:title" content="子质’s Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="子质’s Notes">
<meta property="og:description" content="Learning is a gift , even when pain is your teacher.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="子质’s Notes">
<meta name="twitter:description" content="Learning is a gift , even when pain is your teacher.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>子质’s Notes</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a6854a84eb2937313a5e93041915e65f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">子质’s Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/23/工作随手记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/工作随手记/" itemprop="url">未命名</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T14:27:11+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/23/工作随手记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/03/23/工作随手记/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2018/03/23/工作随手记/" class="leancloud_visitors" data-flag-title="">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1  开发的点歌系统需要连接局域网的mysql服务器实现检索，导入mysqljdbc的驱动jar包，编译一直报错，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Error:Error converting bytecode to dex:</div><div class="line">Cause: Dex cannot parse version 52 byte code.</div><div class="line">This is caused by library dependencies that have been compiled using Java 8 or above.</div><div class="line">If you are using the &apos;java&apos; gradle plugin in a library submodule add </div><div class="line">targetCompatibility = &apos;1.7&apos;</div><div class="line">sourceCompatibility = &apos;1.7&apos;</div><div class="line">to that submodule&apos;s build.gradle file.</div></pre></td></tr></table></figure></p>
<p>按照网上的方法，修改gradle文件，在android{}中 添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">compileOptions &#123;</div><div class="line">        sourceCompatibility JavaVersion.VERSION_1_7</div><div class="line">        targetCompatibility JavaVersion.VERSION_1_7</div><div class="line">		&#125;</div></pre></td></tr></table></figure></p>
<p>  亦或是在项目的buld.gradle文件下，allprojects{}添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tasks.withType(JavaCompile) &#123;</div><div class="line">        sourceCompatibility = &apos;1.7&apos;</div><div class="line">        targetCompatibility = &apos;1.7&apos;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>都没能解决问题，最后我通过新建一个library的module,然后将jar包放到改library的libs目录下，成功解决，如果你也遇到相同问题，希望有所帮助。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/23/科学上网笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/科学上网笔记/" itemprop="url">Vultr搭建Shadowsocks科学上网</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-23T12:18:52+08:00">
                2018-03-23
              </time>
            

            

            
          </span>

          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/23/科学上网笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/03/23/科学上网笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2018/03/23/科学上网笔记/" class="leancloud_visitors" data-flag-title="Vultr搭建Shadowsocks科学上网">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>因为工作原因，要经常去Google搜索资料，在VPS上搭建Shadowsocks实现科学上网。</p>
<p>Vultr的服务器性价比比较高，并且支持支付宝充值，还是很方便的，一般的服务器是$5/m，部分服务器最低<br>$2.5/m，ipPing不通，换个服务器只要1分钱，snapshot功能换服务器也很简单。</p>
</blockquote>
<h3 id="1-购买服务器"><a href="#1-购买服务器" class="headerlink" title="1.购买服务器"></a>1.购买服务器</h3><ul>
<li>注册Vultr，地址[<a href="https://www.vultr.com/" target="_blank" rel="external">https://www.vultr.com/</a>]</li>
<li>充值，选择左侧Billing，支持支付宝充值，按照网站向导走即可。</li>
<li>部署服务器。选择左侧栏的Servers，网上说Server Location是Los Angels和Tokyo的比较好，我在配置的时候发现都ping不同，所以我选了新加坡的服务器，延迟还可以接受，YouTube也没压力，Server Type选择Ubuntu 16.04，Server Size根据需求选择，Additional Features中勾选Enable IPv6。其他都可以默认，然后选择Deploy Now就可以了。<h3 id="2-配置Shadowsocks"><a href="#2-配置Shadowsocks" class="headerlink" title="2.配置Shadowsocks"></a>2.配置Shadowsocks</h3></li>
<li><p>连接远程服务器。<br>  Windows使用xshell,在xshell中新建连接，输入vps的ip地址，连接成功后输入vultr网站上部署的服务器的用户名和密码。</p>
<p>相比于Windows使用Xshell连接远程Linux服务器，Mac OS系统上可以直接用终端Terminal实现，不需要借助第三方软件，ssh端口非默认的22也可以直接登录。<br>直接打开Terminal终端，输入：ssh root@ip地址，之后输入你的密码就可以登录了（输入密码的时候屏幕上不会有显示）如果你的ssh端口不是默认的22，那么就用-p参数接上你的ssh端口，例如你的VPS的ssh端口是1234，那么命令就是：ssh root@ip地址 -p 1234</p>
<p>如果连接不上，在命令行窗口试试看能不能ping通服务器地址，如果不通的话，可将服务器删除，重新部署试试，此步骤可以多试几次。</p>
</li>
<li><p>搭建shadowsocks<br>以下的步骤都是在服务器上以root权限进行的（Vultr也默认是root用户），如果不是root，自行加sudo管理员权限执行。</p>
<p>更新软件源<br><code>apt-get update</code></p>
<p>安装pip环境<br><code>apt-get install python-pip</code></p>
<p>更新pip版本<br><code>pip install --upgrade pip</code></p>
<p>安装setuptools模块<br><code>pip install setuptools</code></p>
<p>安装shadowsocks<br><code>pip install shadowsocks</code></p>
<p>编辑配置文件<br><code>vim /etc/shadowsocks.json</code><br>{<br>  “server”:”0.0.0.0”,<br>  “server_port”:1024,<br>  “local_address”: “127.0.0.1”,<br>  “local_port”:1080,<br>  “password”:”mypassword”,<br>  “timeout”:300,<br>  “method”:”aes-256-cfb”<br>}</p>
<p>将其中的mypassword换成你想设置的密码（不需要跟你的VPS密码一致，这个密码你用来在客户端连接服务器ss的），server可以是0.0.0.0，也可以是你VPS的IP。</p>
<p>赋予shadowsocks配置文件权限<br><code>chmod 755 /etc/shadowsocks.json</code></p>
<p>安装以支持这些加密方式<br><code>apt-get install python-m2crypto</code></p>
<p>后台运行shadowsocks<br><code>ssserver -c /etc/shadowsocks.json -d start</code><br>设置shadowsocks开机自启动</p>
<figure class="highlight vim"><figcaption><span>/etc/rc.local```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"> 在<span class="keyword">exit</span> <span class="number">0</span>前面加上ss的启动命令：</div><div class="line"></div><div class="line">``` awk</div><div class="line">#!/bin/<span class="keyword">sh</span> -<span class="keyword">e</span></div><div class="line">#</div><div class="line"># rc.local</div><div class="line">#</div><div class="line"># This script <span class="keyword">is</span> executed at the end of each multiuser runlevel.</div><div class="line"># Make sure that the script will <span class="string">"exit 0"</span> <span class="keyword">on</span> success <span class="built_in">or</span> any other</div><div class="line"># value <span class="keyword">on</span> error.</div><div class="line">#</div><div class="line"># In order <span class="keyword">to</span> enable <span class="built_in">or</span> disable this script just <span class="keyword">change</span> the execution</div><div class="line"># bits.</div><div class="line">#</div><div class="line"># By default this script does nothing.</div><div class="line">ssserver -<span class="keyword">c</span> /etc/shadowsocks.json -d start</div><div class="line"><span class="keyword">exit</span> <span class="number">0</span></div></pre></td></tr></table></figure>
<p> 如果想停止shadowsocks可使用<br><code>ssserver -c /etc/shadowsocks.json -d stop</code></p>
</li>
</ul>
<h3 id="3-本机上搭建代理"><a href="#3-本机上搭建代理" class="headerlink" title="3.本机上搭建代理"></a>3.本机上搭建代理</h3><p><a href="https://github.com/shadowsocks" target="_blank" rel="external">shadowsocks下载</a>，启动程序后，Windows系统在状态栏右击shadowsocks客户端，勾选开机启动和启动系统代理，在系统代理模式中选择PAC模式，服务器-&gt;编辑服务器，用shadowsocks.json中配置的密码、加密方法以及你VPS的IP填好，保存即可。</p>
<h3 id="4-开启BBR加速"><a href="#4-开启BBR加速" class="headerlink" title="4.开启BBR加速"></a>4.开启BBR加速</h3><p>BBR是一款Google开发的TCP拥塞控制算法，目的是尽量跑满带宽，加速效果不比锐速差，都是基于VPS内核加速的。</p>
<ul>
<li><p>Ubuntu内核升级<br>Ubuntu开启BBR加速的前提是内核高于4.9，所以先检查内核版本：<br><code>uname -a</code><br>如果版本高于4.9，那就可以直接开启BBR，如果低于，则按照以下步骤先更新内核版本（root权限）<br>1.首先确定你的系统是32位还是64位的：<br>getconf LONG_BIT<br>2.直接通过wget命令，去<a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/去下载最新的程序包，例如我去下载64位的4.10.2的内核：" target="_blank" rel="external">http://kernel.ubuntu.com/~kernel-ppa/mainline/去下载最新的程序包，例如我去下载64位的4.10.2的内核：</a><br>wget <a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10.2/linux-image-4.10.2-041002-generic_4.10.2-041002.201703120131_amd64.deb" target="_blank" rel="external">http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.10.2/linux-image-4.10.2-041002-generic_4.10.2-041002.201703120131_amd64.deb</a><br>3.切换到你的文件下载目录，执行下面的命令进行升级：<br>dpkg -i linux-image-4.10.2-041002-generic_4.10.2-041002.201703120131_amd64.deb<br>4.更新grub引导装入程序：<br>update-grub<br>5.重启机器：<br>reboot<br>再查看自己的内核版本就会发现已经更新到4.10.2了~</p>
</li>
<li><p>开启TCP BBR加速<br>1.修改系统变量：<br>echo “net.core.default_qdisc=fq” &gt;&gt; /etc/sysctl.conf<br>echo “net.ipv4.tcp_congestion_control=bbr” &gt;&gt; /etc/sysctl.conf<br>如果执行以上命令时显示拒绝访问则可以尝试使用如下命令：<br>sudo bash -c ‘echo “net.core.default_qdisc=fq” &gt;&gt; /etc/sysctl.conf’<br>sudo bash -c ‘echo “net.ipv4.tcp_congestion_control=bbr” &gt;&gt; /etc/sysctl.conf’<br>2.保存生效：<br>sysctl -p<br>3.查看是否开启成功<br>执行如下命令：<br>sysctl net.ipv4.tcp_available_congestion_control<br>如果返回结果为：et.ipv4.tcp_available_congestion_control = bbr cubic reno，那么恭喜你BBR开启成功了。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/13/scope_chains_closures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/13/scope_chains_closures/" itemprop="url">Scope Chains Closures</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-13T17:27:35+08:00">
                2017-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node-js/" itemprop="url" rel="index">
                    <span itemprop="name">node.js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/13/scope_chains_closures/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/13/scope_chains_closures/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/13/scope_chains_closures/" class="leancloud_visitors" data-flag-title="Scope Chains Closures">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Scopes"><a href="#Scopes" class="headerlink" title="Scopes"></a>Scopes</h1><p>The main type of scope in Javascript is Lexical Scoping. Present in the language<br>from the very beginning, this is the scope created within a function, and the<br>one most developers are familiar with.[1]</p>
<p>ES6 recently defined Block Scoping. This scope is created within curly braced<br>blocks.[2]</p>
<h2 id="Intializing-Variables"><a href="#Intializing-Variables" class="headerlink" title="Intializing Variables"></a>Intializing Variables</h2><p>The way a variable is initialized determines which scope type it is:</p>
<h3 id="Lexical-Scope"><a href="#Lexical-Scope" class="headerlink" title="Lexical Scope"></a>Lexical Scope</h3><p>var is used to denote a variable which is Lexically Scoped to the current<br>function:</p>
<pre><code>function someFunc() {
  var aVariable;
}
</code></pre><p>aVariable is lexically scoped within someFunc</p>
<h3 id="Block-Scope"><a href="#Block-Scope" class="headerlink" title="Block Scope"></a>Block Scope</h3><p>let &amp; const are used to denote variables which are Block Scoped to the<br>current curly braced block:</p>
<pre><code>if (true) {
  let aVariable;
}
</code></pre><p>aVariable is block scoped within the if’s curly braces</p>
<hr>

<h1 id="Scope-Chains"><a href="#Scope-Chains" class="headerlink" title="Scope Chains"></a>Scope Chains</h1><h2 id="Nesting"><a href="#Nesting" class="headerlink" title="Nesting"></a>Nesting</h2><p>Scopes can be nested. Both Lexical and Block scopes can contain other scopes:</p>
<pre><code>function someFunc() {
  function inner() {
  }
}
</code></pre><p>inner is a nested lexical scope inside the lexical scope of someFunc</p>
<hr>
<pre><code>if (true) {
  while (false) {
  }
}
</code></pre><p>The while is a nested block scope inside the block scope of if</p>
<hr>
<pre><code>function someFunc() {
  if (true) {
  }
}
</code></pre><p>The if is a nested block scope inside the lexical scope of someFunc</p>
<hr>
<h2 id="Scoped-Variable-Access"><a href="#Scoped-Variable-Access" class="headerlink" title="Scoped Variable Access"></a>Scoped Variable Access</h2><p>All nested scopes follow the same rule: Each nested inner scope has access to<br>outer scope variables, but NOT vice-versa.</p>
<p>For example:</p>
<pre><code>function someFunc() {
  var outerVar = 1;
  function inner() {
    var innerVar = 2;
  }
}
</code></pre><p>inner has access to both innerVar &amp; outerVar, but someFunc only has<br>access to outerVar</p>
<h2 id="Multiple-Nested-Scopes"><a href="#Multiple-Nested-Scopes" class="headerlink" title="Multiple Nested Scopes"></a>Multiple Nested Scopes</h2><p>Nesting isn’t limited to a single inner scope, there can be multiple nested<br>scopes, each of which adhere to the Scoped Variable Access rule above. With<br>one addition: sibling scopes are also restricted from accessing each other’s<br>variables.</p>
<p>For example:</p>
<pre><code>function someFunc() {
  function inner() {
  }
  function inner2() {
  }
}
</code></pre><p>inner &amp; inner2 are both inner scopes of someFunc. Just as someFunc<br>cannot access inner’s variables, inner cannot access inner2’s variables<br>(and vice versa)</p>
<h2 id="Scope-Tree"><a href="#Scope-Tree" class="headerlink" title="Scope Tree"></a>Scope Tree</h2><p>Looking at the nesting from top-down, a tree of scopes is formed.</p>
<p>This code</p>
<pre><code>function someFunc() {
  function inner() {
  }
  function inner2() {
    function foo() {
    }
  }
}
</code></pre><p>Produces this tree</p>
<pre><code>   someFunc()
       |
      / \
     /   \
    /     \
   ↓       ↓
inner()  inner2()
           |
           ↓
         foo()
</code></pre><p>Remembering that inner scopes can access outer scope’s variables, but not<br>vice-versa (foo() can access inner2()’s variables, and inner2() can access<br>someFunc()’s variables), then it makes more sense to look at the tree from<br>bottom-up, which forms a chain, also known as…</p>
<h2 id="Scope-Chains-1"><a href="#Scope-Chains-1" class="headerlink" title="Scope Chains"></a>Scope Chains</h2><p>Looking from most inner to most outer scope forms a Scope Chain.</p>
<pre><code>someFunc()
    ↑
     \
      \
       \
      inner2()
        ↑
        |
      foo()
</code></pre><hr>

<h1 id="Global-Scope-amp-Shadowing"><a href="#Global-Scope-amp-Shadowing" class="headerlink" title="Global Scope &amp; Shadowing"></a>Global Scope &amp; Shadowing</h1><h2 id="Global-Scope"><a href="#Global-Scope" class="headerlink" title="Global Scope"></a>Global Scope</h2><p>Understanding where Scope Chains end is an important part of scoping. All<br>Javascript runtimes must implicitly create a Global Scope object (window in<br>the browser, global in node), which sits at the top of every scope chain:</p>
<pre><code>    (global)
       ↑
       |
   someFunc()
       ↑
      / \
     /   \
    /     \
inner()  inner2()
           ↑
           |
         foo()
</code></pre><p>In Scopes we covered how usage of var or let dictates the scope of the<br>variable being defined. When assigning a variable without using either of var,<br>let, etc, the variable is assumed to exist in an outer scope.</p>
<p>The javascript runtime follows these steps to assign a variable:</p>
<p> 1) Search within the current scope.<br> 2) If not found, search in the immediately outer scope.<br> 3) If found, go to 6.<br> 4) If not found, repeat 2. Until the Global Scope is reached.<br> 5) If not found in Global Scope, create it (on window / global objects).<br> 6) Assign the value.</p>
<p>In this way, it is possible to accidentally define a global variable (step 5).</p>
<h3 id="Example-Global-Scope"><a href="#Example-Global-Scope" class="headerlink" title="Example Global Scope"></a>Example Global Scope</h3><p>Consider the following example:</p>
<pre><code>function someFunc() {
   var scopedVar = 1;
   function inner() {
      foo = 2;
   }
}
</code></pre><p>Note the lack of var or let, etc for foo = 2. The Javascript runtime will<br>follow the above algorithm, first checking the scope of inner(), then of<br>someFunc(), then finally the Global Scope. Step 5 is then executed, so foo<br>becomes a variable in the Global Scope (window.foo / global.foo).</p>
<p>Phrased another way: By accidentally forgetting to use var, the variable foo<br>which otherwise would have been only within the lexical scope of inner() is<br>now available to be modified by any scope. So, someFunc() now has access<br>where the developer may have meant for it not to.</p>
<p>Remember: Only inner scopes can access variables of outer scopes. In this case<br>the someFunc() scope is an inner scope of the Global Scope, allowing access of<br>foo to someFunc().</p>
<h2 id="Shadowing"><a href="#Shadowing" class="headerlink" title="Shadowing"></a>Shadowing</h2><p>A variable is created in a ‘Step 0)’ of the above algorithm: When var or let<br>is used. The variable is assigned to the correct scope, then execution moves on,<br>and any assignments to that variable follow the above algorithm.</p>
<p>It is perfectly valid to define two different variables, in different scopes,<br>with the same name:</p>
<pre><code>function someFunc() {
   var foo = 1;
}
function anotherFunc() {
   var foo = 2;
}
</code></pre><p>It is also valid to do this in nested scopes:</p>
<pre><code>function someFunc() {
   var foo = 1;
   function inner() {
      var foo = 2;
   }
}
</code></pre><p>This is called Shadowing. The foo inside inner() is said to Shadow the foo<br>inside someFunc.</p>
<p>Shadowing means that the inner() scope only has access to its own foo. There<br>is no way for it to access the foo defined in someFunc().</p>
<p>This can also be an accidental source of bugs, especially when there is deep<br>nesting, or long functions.</p>
<hr>

<h1 id="Closures"><a href="#Closures" class="headerlink" title="Closures"></a>Closures</h1><p>Closures are an important part of the Javascript language. They are what enables<br>the callback-last programming most prominent in node, and provide an excellent<br>mechanism for handling the asynchronous nature of most Javascript tasks.</p>
<p>To properly understand closures, let’s start with an example scope chain:</p>
<pre><code>someFunc()
    ↑
    |
 inner()
    ↑
    |
  foo()
</code></pre><p>Let’s say someFunc() declares a variable bar:</p>
<pre><code>someFunc()
 var bar
    ↑
    ⋮
</code></pre><p>Given how nesting scope works, it’s possible for an inner scope within<br>someFunc() to access bar. In this example, let’s say inner() accesses<br>bar:</p>
<pre><code>someFunc()
 var bar
    ↑
    |
 inner()
alert(bar)
    ↑
    ⋮
</code></pre><p>Then inner() is said to Close Over bar. Therefore inner() is a Closure.</p>
<p>To power the callback style of programming, the closure will be maintained even<br>if inner() isn’t executed immediately. It is perfectly legal in Javascript to<br>pass inner around / return it from someFunc() for later execution. All the<br>while, bar will continue to be available.</p>
<hr>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/13/how_to_npm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/13/how_to_npm/" itemprop="url">How  to  npm</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-13T13:58:26+08:00">
                2017-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node-js/" itemprop="url" rel="index">
                    <span itemprop="name">node.js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/13/how_to_npm/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/13/how_to_npm/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/13/how_to_npm/" class="leancloud_visitors" data-flag-title="How  to  npm">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Dev-Environment"><a href="#Dev-Environment" class="headerlink" title="Dev Environment"></a>Dev Environment</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm init  创建package.json  初始化工程</div></pre></td></tr></table></figure>
<h3 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm whoami  查看当前账户</div><div class="line">npm adduser	创建账户</div></pre></td></tr></table></figure>
<h3 id="Start-A-Project"><a href="#Start-A-Project" class="headerlink" title="Start A Project"></a>Start A Project</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm init --scope=&lt;username&gt;	替换username为你的账户</div></pre></td></tr></table></figure>
<h3 id="Install-A-Module"><a href="#Install-A-Module" class="headerlink" title="Install A Module"></a>Install A Module</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install &lt;modulename&gt;</div></pre></td></tr></table></figure>
<h3 id="Listing-Dependencies"><a href="#Listing-Dependencies" class="headerlink" title="Listing Dependencies"></a>Listing Dependencies</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm ls</div></pre></td></tr></table></figure>
<h3 id="npm-Test"><a href="#npm-Test" class="headerlink" title="npm Test"></a>npm Test</h3><p>创建test.js并配置package.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;scripts&quot;: &#123;</div><div class="line">        &quot;test&quot;: &quot;node test.js&quot;</div><div class="line">      &#125;</div></pre></td></tr></table></figure>
<h3 id="Package-Niceties"><a href="#Package-Niceties" class="headerlink" title="Package Niceties"></a>Package Niceties</h3><p>创建README.md<br>在package.json中添加字段’repository’，description.</p>
<h3 id="Publish"><a href="#Publish" class="headerlink" title="Publish"></a>Publish</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm publish 将module发布到registry</div></pre></td></tr></table></figure>
<h3 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm version</div></pre></td></tr></table></figure>
<h3 id="Publish-Again"><a href="#Publish-Again" class="headerlink" title="Publish Again"></a>Publish Again</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">更新版本号后</div><div class="line">执行npm publish</div></pre></td></tr></table></figure>
<h3 id="Dist-Tag"><a href="#Dist-Tag" class="headerlink" title="Dist Tag"></a>Dist Tag</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm dist-tag add pkg@version [&lt;tag&gt;]</div></pre></td></tr></table></figure>
<h3 id="Dist-Tag-Removal"><a href="#Dist-Tag-Removal" class="headerlink" title="Dist Tag Removal"></a>Dist Tag Removal</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm dist-tag rm pkg  [&lt;tag&gt;]</div></pre></td></tr></table></figure>
<h3 id="Outdated"><a href="#Outdated" class="headerlink" title="Outdated"></a>Outdated</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm outdated</div></pre></td></tr></table></figure>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm update</div></pre></td></tr></table></figure>
<h3 id="Rm"><a href="#Rm" class="headerlink" title="Rm"></a>Rm</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm rm pkg@version --save</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/11/learnyounode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/11/learnyounode/" itemprop="url">Learning Node.js</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-11T16:03:54+08:00">
                2017-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node-js/" itemprop="url" rel="index">
                    <span itemprop="name">node.js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/11/learnyounode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/10/11/learnyounode/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/10/11/learnyounode/" class="leancloud_visitors" data-flag-title="Learning Node.js">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="HELLO-WORLD-Exercise-1-of-13"><a href="#HELLO-WORLD-Exercise-1-of-13" class="headerlink" title="HELLO WORLD (Exercise 1 of 13)"></a>HELLO WORLD (Exercise 1 of 13)</h3><p>  Write a program that prints the text “HELLO WORLD” to the console<br>  (stdout).<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">console.log(&quot;HELLO WORLD&quot;)</div></pre></td></tr></table></figure></p>
<h3 id="BABY-STEPS-Exercise-2-of-13"><a href="#BABY-STEPS-Exercise-2-of-13" class="headerlink" title="BABY STEPS (Exercise 2 of 13)"></a>BABY STEPS (Exercise 2 of 13)</h3><p>  Write a program that accepts one or more numbers as command-line arguments<br>  and prints the sum of those numbers to the console (stdout). </p>
<figure class="highlight irpf90"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let <span class="built_in">sum</span> = <span class="number">0</span></div><div class="line"></div><div class="line">process.argv.forEach((item,<span class="built_in">index</span>) =&gt; &#123;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">index</span>&gt;<span class="number">1</span>)</div><div class="line">        <span class="built_in">sum</span>+=<span class="keyword">Number</span>(item)</div><div class="line">&#125;);</div><div class="line">console.<span class="built_in">log</span>(<span class="built_in">sum</span>)</div></pre></td></tr></table></figure>
<h3 id="MY-FIRST-I-O-Exercise-3-of-13"><a href="#MY-FIRST-I-O-Exercise-3-of-13" class="headerlink" title="MY FIRST I/O! (Exercise 3 of 13)"></a>MY FIRST I/O! (Exercise 3 of 13)</h3><p>  Write a program that uses a single synchronous filesystem operation to<br>  read a file and print the number of newlines (\n) it contains to the<br>  console (stdout), similar to running cat file | wc -l.</p>
<p>  The full path to the file to read will be provided as the first<br>  command-line argument (i.e., process.argv[2]). You do not need to make<br>  your own test file.<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">  let fs = require(&quot;fs&quot;)</div><div class="line"></div><div class="line">let data = fs.readFileSync(process.argv[2],&quot;utf-8&quot;);</div><div class="line">console.log(data.split(&quot;\n&quot;).length -1);</div></pre></td></tr></table></figure></p>
<h3 id="MY-FIRST-ASYNC-I-O-Exercise-4-of-13"><a href="#MY-FIRST-ASYNC-I-O-Exercise-4-of-13" class="headerlink" title="MY FIRST ASYNC I/O! (Exercise 4 of 13)"></a>MY FIRST ASYNC I/O! (Exercise 4 of 13)</h3><p>  Write a program that uses a single asynchronous filesystem operation to<br>  read a file and print the number of newlines it contains to the console<br>  (stdout), similar to running cat file | wc -l.</p>
<p>  The full path to the file to read will be provided as the first<br>  command-line argument.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">var fs = require(&quot;fs&quot;)</div><div class="line"></div><div class="line">fs.readFile(process.argv[2],&quot;utf-8&quot;,(err,data) =&gt; &#123;</div><div class="line">    let newlines = 0</div><div class="line">    if(err) console.error(err)</div><div class="line">    for (let codepoint of data)&#123;</div><div class="line"></div><div class="line">        if(codepoint===&quot;\n&quot;)</div><div class="line">            newlines++;</div><div class="line">    &#125;</div><div class="line">    console.log(newlines)</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="FILTERED-LS-Exercise-5-of-13"><a href="#FILTERED-LS-Exercise-5-of-13" class="headerlink" title="FILTERED LS (Exercise 5 of 13)"></a>FILTERED LS (Exercise 5 of 13)</h3><p>  Create a program that prints a list of files in a given directory,<br>  filtered by the extension of the files. You will be provided a directory<br>  name as the first argument to your program (e.g. ‘/path/to/dir/‘) and a<br>  file extension to filter by as the second argument.</p>
<p>  For example, if you get ‘txt’ as the second argument then you will need to<br>  filter the list to only files that end with .txt. Note that the second<br>  argument will not come prefixed with a ‘.’.</p>
<p>  Keep in mind that the first arguments of your program are not the first<br>  values of the process.argv array, as the first two values are reserved for<br>  system info by Node.</p>
<p>  The list of files should be printed to the console, one file per line. You<br>  must use asynchronous I/O.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">let fs = require(&quot;fs&quot;)</div><div class="line"></div><div class="line">fs.readdir(process.argv[2], (err, list) =&gt; &#123;</div><div class="line">    if (err) return console.error(err)</div><div class="line">    list.forEach((item) =&gt; &#123;</div><div class="line">        if (item.endsWith(&quot;.&quot; + process.argv[3]))</div><div class="line">            console.log(item)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="MAKE-IT-MODULAR-Exercise-6-of-13"><a href="#MAKE-IT-MODULAR-Exercise-6-of-13" class="headerlink" title="MAKE IT MODULAR (Exercise 6 of 13)"></a>MAKE IT MODULAR (Exercise 6 of 13)</h3><p>  This problem is the same as the previous but introduces the concept of<br>  modules. You will need to create two files to solve this.</p>
<p>  Create a program that prints a list of files in a given directory,<br>  filtered by the extension of the files. The first argument is the<br>  directory name and the second argument is the extension filter. Print the<br>  list of files (one file per line) to the console. You must use<br>  asynchronous I/O.</p>
<p>  You must write a module file to do most of the work. The module must<br>  export a single function that takes three arguments: the directory name,<br>  the filename extension string and a callback function, in that order. The<br>  filename extension argument must be the same as what was passed to your<br>  program. Don’t turn it into a RegExp or prefix with “.” or do anything<br>  except pass it to your module where you can do what you need to make your<br>  filter work.</p>
<p>  The callback function must be called using the idiomatic node(err, data)<br>  convention. This convention stipulates that unless there’s an error, the<br>  first argument passed to the callback will be null, and the second will be<br>  your data. In this exercise, the data will be your filtered list of files,<br>  as an Array. If you receive an error, e.g. from your call to<br>  fs.readdir(), the callback must be called with the error, and only the<br>  error, as the first argument.</p>
<p>  You must not print directly to the console from your module file, only<br>  from your original program.</p>
<p>  In the case of an error bubbling up to your original program file, simply<br>  check for it and print an informative message to the console.</p>
<p>  These four things are the contract that your module must follow.</p>
<ol>
<li>Export a single function that takes exactly the arguments described.</li>
<li>Call the callback exactly once with an error or some data as described.</li>
<li>Don’t change anything else, like global variables or stdout.</li>
<li>Handle all the errors that may occur and pass them to the callback.</li>
</ol>
<p>The benefit of having a contract is that your module can be used by anyone<br>who expects this contract. So your module could be used by anyone else who<br>does learnyounode, or the verifier, and just work.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">let fs = require(&quot;fs&quot;)</div><div class="line"></div><div class="line">module.exports =  function foo(dir,ext,callback) &#123;</div><div class="line">    fs.readdir(dir, (err, data) =&gt; &#123;</div><div class="line">        if(err)  return callback(err)</div><div class="line">        let list = []</div><div class="line">        data.forEach((item) =&gt; &#123;</div><div class="line">            if (item.endsWith(&quot;.&quot; + ext))</div><div class="line">                list.push(item)</div><div class="line">        &#125;)</div><div class="line">        callback(null,list)</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">let foo = require(&apos;./module2.js&apos;);</div><div class="line"></div><div class="line">foo(process.argv[2],process.argv[3],(err,data) =&gt;&#123;</div><div class="line">    if(err)</div><div class="line">        return console.error(err)</div><div class="line">    data.forEach((item)=&gt;&#123;</div><div class="line">        console.log(item)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="HTTP-CLIENT-Exercise-7-of-13"><a href="#HTTP-CLIENT-Exercise-7-of-13" class="headerlink" title="HTTP CLIENT (Exercise 7 of 13)"></a>HTTP CLIENT (Exercise 7 of 13)</h3><p> Write a program that performs an HTTP GET request to a URL provided to you<br>  as the first command-line argument. Write the String contents of each<br>  “data” event from the response to a new line on the console (stdout).<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">  let http = require(&apos;http&apos;)</div><div class="line"></div><div class="line">http.get(process.argv[2],(res)=&gt;&#123;</div><div class="line">    res.setEncoding(&apos;utf-8&apos;)</div><div class="line">    res.on(&apos;error&apos;,(error)=&gt;&#123;</div><div class="line">        return console.error(error)</div><div class="line">    &#125;)</div><div class="line">    res.on(&quot;data&quot;,(data)=&gt;&#123;</div><div class="line">        console.log(data)</div><div class="line">    &#125;)</div><div class="line">&#125;).on(&quot;error&quot;,console.error)</div></pre></td></tr></table></figure></p>
<h3 id="HTTP-COLLECT-Exercise-8-of-13"><a href="#HTTP-COLLECT-Exercise-8-of-13" class="headerlink" title="HTTP COLLECT (Exercise 8 of 13)"></a>HTTP COLLECT (Exercise 8 of 13)</h3><p> Write a program that performs an HTTP GET request to a URL provided to you<br>  as the first command-line argument. Collect all data from the server (not<br>  just the first “data” event) and then write two lines to the console<br>  (stdout).</p>
<p>  The first line you write should just be an integer representing the number<br>  of characters received from the server. The second line should contain the<br>  complete String of characters sent by the server.<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">  let http = require(&quot;http&quot;)</div><div class="line">let concatstream = require(&quot;concat-stream&quot;)</div><div class="line"></div><div class="line">http.get(process.argv[2], (res) =&gt; &#123;</div><div class="line"></div><div class="line">    res.on(&quot;error&quot;, console.error)</div><div class="line">    res.on(&quot;data&quot;, (data) =&gt; &#123;</div><div class="line"></div><div class="line">    &#125;)</div><div class="line">    res.pipe(concatstream((data) =&gt; &#123;</div><div class="line">        console.log(data.toString().length)</div><div class="line">        console.log(data.toString())</div><div class="line">    &#125;))</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="JUGGLING-ASYNC-Exercise-9-of-13"><a href="#JUGGLING-ASYNC-Exercise-9-of-13" class="headerlink" title="JUGGLING ASYNC (Exercise 9 of 13)"></a>JUGGLING ASYNC (Exercise 9 of 13)</h3><p> This problem is the same as the previous problem (HTTP COLLECT) in that<br>  you need to use http.get(). However, this time you will be provided with<br>  three URLs as the first three command-line arguments.</p>
<p>  You must collect the complete content provided to you by each of the URLs<br>  and print it to the console (stdout). You don’t need to print out the<br>  length, just the data as a String; one line per URL. The catch is that you<br>  must print them out in the same order as the URLs are provided to you as<br>  command-line arguments.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">let http = require(&apos;http&apos;)</div><div class="line"></div><div class="line">const list = []</div><div class="line">list.push(process.argv[2])</div><div class="line">list.push(process.argv[3])</div><div class="line">list.push(process.argv[4])</div><div class="line">const data = []</div><div class="line"></div><div class="line"></div><div class="line">function fetch(url, callback) &#123;</div><div class="line">    http.get(url, res =&gt; &#123;</div><div class="line">        let buff = []</div><div class="line">        res.on(&quot;data&quot;, data =&gt; &#123;</div><div class="line">            buff += data</div><div class="line">        &#125;)</div><div class="line">        res.on(&quot;end&quot;, () =&gt; &#123;</div><div class="line">            data.push(buff.toString())</div><div class="line">            callback()</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">fetch(list[0], () =&gt; &#123;</div><div class="line">    fetch(list[1], () =&gt; &#123;</div><div class="line">        fetch(list[2], () =&gt; &#123;</div><div class="line">            data.forEach(item =&gt; &#123;</div><div class="line">                console.log(item)</div><div class="line">            &#125;)</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="TIME-SERVER-Exercise-10-of-13"><a href="#TIME-SERVER-Exercise-10-of-13" class="headerlink" title="TIME SERVER (Exercise 10 of 13)"></a>TIME SERVER (Exercise 10 of 13)</h3><p> Write a TCP time server!</p>
<p> Your server should listen to TCP connections on the port provided by the<br> first argument to your program. For each connection you must write the<br> current date &amp; 24 hour time in the format:</p>
<pre><code>&quot;YYYY-MM-DD hh:mm&quot;
</code></pre><p> followed by a newline character. Month, day, hour and minute must be<br> zero-filled to 2 integers. For example:</p>
<pre><code>&quot;2013-07-06 17:42&quot;
</code></pre><p> After sending the string, close the connection.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let net = require(&apos;net&apos;)</div><div class="line"></div><div class="line">net.createServer(socket =&gt; &#123;</div><div class="line">    let date = new Date()</div><div class="line">    &quot;x&quot;.padStart(3, &quot;0&quot;)</div><div class="line">    socket.end(date.getFullYear() + &quot;-&quot; + ((date.getMonth() + 1).toString().padStart(2, &quot;0&quot;))</div><div class="line">        + &quot;-&quot; + (date.getDate().toString().padStart(2, &quot;0&quot;)) + &quot; &quot; + date.getHours() + &quot;:&quot; + date.getMinutes()+&quot;\n&quot;)</div><div class="line">&#125;).listen(process.argv[2])</div></pre></td></tr></table></figure></p>
<h3 id="HTTP-FILE-SERVER-Exercise-11-of-13"><a href="#HTTP-FILE-SERVER-Exercise-11-of-13" class="headerlink" title="HTTP FILE SERVER (Exercise 11 of 13)"></a>HTTP FILE SERVER (Exercise 11 of 13)</h3><p>Write an HTTP server that serves the same text file for each request it<br>receives.</p>
<p>Your server should listen on the port provided by the first argument to<br>your program.</p>
<p>You will be provided with the location of the file to serve as the second<br>command-line argument. You must use the fs.createReadStream() method to<br>stream the file contents to the response.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let http = require(&quot;http&quot;)</div><div class="line">let fs = require(&quot;fs&quot;)</div><div class="line">const file = process.argv[3]</div><div class="line">console.log(file)</div><div class="line">http.createServer((req,res) =&gt; &#123;</div><div class="line">    fs.createReadStream(file).pipe(res)</div><div class="line">&#125;).listen(process.argv[2])</div></pre></td></tr></table></figure></p>
<h3 id="HTTP-UPPERCASERER-Exercise-12-of-13"><a href="#HTTP-UPPERCASERER-Exercise-12-of-13" class="headerlink" title="HTTP UPPERCASERER (Exercise 12 of 13)"></a>HTTP UPPERCASERER (Exercise 12 of 13)</h3><p> Write an HTTP server that receives only POST requests and converts<br> incoming POST body characters to upper-case and returns it to the client.</p>
<p> Your server should listen on the port provided by the first argument to<br> your program.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">let http = require(&quot;http&quot;)</div><div class="line">let map = require(&quot;through2-map&quot;)</div><div class="line"></div><div class="line">http.createServer((req, res) =&gt; &#123;</div><div class="line">    if (req.method == &quot;POST&quot;) &#123;</div><div class="line">        req.pipe(map(chunk =&gt; &#123;</div><div class="line">            return chunk.toString().toUpperCase()</div><div class="line">        &#125;)).pipe(res)</div><div class="line">    &#125;</div><div class="line">&#125;).listen(process.argv[2])</div></pre></td></tr></table></figure></p>
<h3 id="HTTP-JSON-API-SERVER-Exercise-13-of-13"><a href="#HTTP-JSON-API-SERVER-Exercise-13-of-13" class="headerlink" title="HTTP JSON API SERVER (Exercise 13 of 13)"></a>HTTP JSON API SERVER (Exercise 13 of 13)</h3><p> Write an HTTP server that serves JSON data when it receives a GET request<br> to the path ‘/api/parsetime’. Expect the request to contain a query string<br> with a key ‘iso’ and an ISO-format time as the value.</p>
<p> For example:</p>
<p> /api/parsetime?iso=2013-08-10T12:10:15.474Z</p>
<p> The JSON response should contain only ‘hour’, ‘minute’ and ‘second’<br> properties. For example:</p>
<pre><code>{
  &quot;hour&quot;: 14,
  &quot;minute&quot;: 23,
  &quot;second&quot;: 15
}
</code></pre><p> Add second endpoint for the path ‘/api/unixtime’ which accepts the same<br> query string but returns UNIX epoch time in milliseconds (the number of<br> milliseconds since 1 Jan 1970 00:00:00 UTC) under the property ‘unixtime’.<br> For example:</p>
<pre><code>{ &quot;unixtime&quot;: 1376136615474 }
</code></pre><p> Your server should listen on the port provided by the first argument to<br> your program.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">let http = require(&quot;http&quot;)</div><div class="line">let url = require(&quot;url&quot;)</div><div class="line"></div><div class="line">http.createServer((req, res) =&gt; &#123;</div><div class="line">    let urlObj = url.parse(req.url, true)</div><div class="line">    let isoDate = urlObj.query.iso</div><div class="line">    let date = new Date(isoDate)</div><div class="line">    let result</div><div class="line">    if (urlObj.pathname == &quot;/api/parsetime&quot;) &#123;</div><div class="line">        result = res.end(JSON.stringify(&#123;</div><div class="line">            hour: date.getHours(),</div><div class="line">            minute: date.getMinutes(),</div><div class="line">            second: date.getSeconds()</div><div class="line">        &#125;))</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (urlObj.pathname == &quot;/api/unixtime&quot;) &#123;</div><div class="line">        result = res.end(JSON.stringify(&#123;</div><div class="line">            unixtime: date.getTime(),</div><div class="line">        &#125;))</div><div class="line">    &#125;</div><div class="line">    if (result) &#123;</div><div class="line">        res.writeHead(200, &#123;&apos;Content-Type&apos;: &apos;application/json&apos;&#125;)</div><div class="line">        res.end(result)</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        res.writeHead(404)</div><div class="line">        res.end()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;).listen(process.argv[2])</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/14/Cardview源码解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/14/Cardview源码解析/" itemprop="url">CardView源码解析-View阴影</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-14T21:13:09+08:00">
                2017-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/14/Cardview源码解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/08/14/Cardview源码解析/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/08/14/Cardview源码解析/" class="leancloud_visitors" data-flag-title="CardView源码解析-View阴影">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>CardView 扩展 FrameLayout 类并让您能够显示卡片内的信息，这些信息在整个平台中拥有一致的呈现方式。CardView 小部件可拥有阴影和圆角。</p>
<p>如果要使用阴影创建卡片，请使用 card_view:cardElevation 属性。CardView 在 Android 5.0（API 级别 21）及更高版本中使用真实高度与动态阴影，而在早期的 Android 版本中则返回编程阴影实现</p>
</blockquote>
<p><img src="http://ohe81rx2w.bkt.clouddn.com/1-UFEQBK-ovYrbSkv-F9v5mw.png" alt=""></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"160dp"</span></div><div class="line">                <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">                <span class="attr">android:src</span>=<span class="string">"@drawable/balon"</span> /&gt;</div><div class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">                <span class="attr">android:padding</span>=<span class="string">"16dp"</span>&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:layout_marginBottom</span>=<span class="string">"8dp"</span></div><div class="line">                    <span class="attr">android:text</span>=<span class="string">"@string/card_title"</span></div><div class="line">                    <span class="attr">android:textColor</span>=<span class="string">"#000"</span></div><div class="line">                    <span class="attr">android:textSize</span>=<span class="string">"18sp"</span> /&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:text</span>=<span class="string">"@string/card_content"</span></div><div class="line">                    <span class="attr">android:textColor</span>=<span class="string">"#555"</span> /&gt;</div><div class="line">            <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:text</span>=<span class="string">"@string/action_share"</span></div><div class="line">                    <span class="attr">android:theme</span>=<span class="string">"@style/PrimaryFlatButton"</span> /&gt;</div><div class="line">                <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">                    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">                    <span class="attr">android:text</span>=<span class="string">"@string/action_explore"</span></div><div class="line">                    <span class="attr">android:theme</span>=<span class="string">"@style/PrimaryFlatButton"</span> /&gt;</div><div class="line">            <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="CardView的常用属性："><a href="#CardView的常用属性：" class="headerlink" title="CardView的常用属性："></a>CardView的常用属性：</h2><table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>card_view:cardElevation</td>
<td>阴影的大小</td>
</tr>
<tr>
<td>card_view:cardMaxElevation</td>
<td>阴影最大高度</td>
</tr>
<tr>
<td>card_view:cardBackgroundColor</td>
<td>卡片的背景色</td>
</tr>
<tr>
<td>card_view:cardCornerRadius</td>
<td>卡片的圆角大小</td>
</tr>
<tr>
<td>card_view:contentPadding</td>
<td>卡片内容于边距的间隔</td>
</tr>
<tr>
<td>card_view:contentPaddingBottom</td>
<td>卡片内容与底部的边距</td>
</tr>
<tr>
<td>card_view:contentPaddingTop</td>
<td>卡片内容与顶部的边距</td>
</tr>
<tr>
<td>card_view:contentPaddingLeft</td>
<td>卡片内容与左边的边距</td>
</tr>
<tr>
<td>card_view:contentPaddingRight</td>
<td>卡片内容与右边的边距</td>
</tr>
<tr>
<td>card_view:contentPaddingStart</td>
<td>卡片内容于边距的间隔起始</td>
</tr>
<tr>
<td>card_view:contentPaddingEnd</td>
<td>卡片内容于边距的间隔终止</td>
</tr>
<tr>
<td>card_view:cardUseCompatPadding</td>
<td>设置内边距，android5.0(代号：Lollipop，API level 21)及以上的版本和之前的版本仍旧具有一样的计算方式</td>
</tr>
<tr>
<td>card_view:cardPreventConrerOverlap</td>
<td>在android5.0之前的版本中添加内边距，这个属性为了防止内容和边角的重叠</td>
</tr>
</tbody>
</table>
<p>CardView的使用比较简单，网上也有相当多的文章可以参考，本文在此不做过多的阐述。<br>CardView的兼容性考虑，在不同版本的系统上实现有差异，大家在使用时要考虑到这一点，我们先看几个小Demo。</p>
<h3 id="cardPreventConrerOverlap属性："><a href="#cardPreventConrerOverlap属性：" class="headerlink" title="cardPreventConrerOverlap属性："></a>cardPreventConrerOverlap属性：</h3><p>Lollipop以下版本，cardPreventConrerOverlap = false,不设置contentPadding,如图，内容和圆角重叠。</p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/overlap_false.png" alt=""><br></div>

<p>Lollipop以下版本，cardPreventConrerOverlap = true,不设置contentPadding,如图，添加了额外padding防止内容和圆角为重叠。</p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/overlap_true_%E7%9C%8B%E5%9B%BE%E7%8E%8B.png" alt=""><br></div>

<p><br></p>
<h3 id="cardUseCompatPadding属性："><a href="#cardUseCompatPadding属性：" class="headerlink" title="cardUseCompatPadding属性："></a>cardUseCompatPadding属性：</h3><p>为了展示出效果，我将elevation设置的比较大，测试设备nexus4 768x1280。<br>下图左侧为Lollipop以下版本，右侧为Lollipop版本，cardUseCompatPadding = false。</p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/5.0_compat_padding_false.png" alt=""><br></div>

<p><br><br>下图左侧为Lollipop以下版本，右侧为Lollipop版本，cardUseCompatPadding = true。<br><br></p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/5.0_compat_padding_true.png" alt=""><br></div>

<p>可见，如果想让Lollipop版本及以上的内边距和Lollipop版本以下相同，就需要把该属性设置为true.。</p>
<p>但该属性的影响没你想的那么简单。<br>我们再往布局中添加一个控件，cardUseCompatPadding= false。   </p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/compat_padding_1.png" alt=""><br></div><br> <br><br>这差距够明显吧！那我们怎样保证各个版本的显示效果相同呢？设置cardUseCompatPadding=true。<br><br><br><br><div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/compat_padding_2.png" alt=""><br></div><br><br><br>这下就ok了，其实导致这种问题出现的根本原因是view的阴影效果在不同版本实现方式存在差异，下文分析源码时会讲到。<br><br>这个问题还有一种解决方式。不设置cardUseCompatPadding属性为true,在Lollipop版本以下对应的dimens.xml中填写cardview的margin = 0dp，在Lollipop版本下（即values-21文件夹）的dimens.xml设置需要的值。<br><br>如果你想给CardView指定明确的宽高呢？<br><br><div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/exct_width_height.png" alt=""><br></div>

<p>什么内容区域大小居然不一样！这种问题要被测试美眉发现岂不是太没面子，怎么解决呢？设置cardUseCompatPadding属性为true。</p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/exct_width_height_compat_padding_true.png" alt=""><br></div>

<p>同理这这个问题也可以通过不同系统版本dimens.xml来适配。</p>
<h3 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h3><ul>
<li><p>CardView通过elevation属性来设置view的阴影，但Lollipop之前的版本是模拟实现，即实现方式不同。</p>
</li>
<li><p>因为裁剪比较耗费性能，所以Lollipop之前的版本不对内部View进行裁剪，通过添加padding的方式避免内部View和圆角重叠。使用setPreventCornerOverlap方法或对应xml card_view:cardPreventConrerOverlap属性可更改这一行为，该属性默认为true。</p>
</li>
<li><p>Lollipop之前的版本，CardView和内容之间添加边距，并在该区域绘制阴影，两边的间距为maxCardElevation + (1 - cos45) <em> cornerRadius，上下的间距为maxCardElevation </em> 1.5 + (1 - cos45) * cornerRadius。</p>
</li>
<li><p>因为padding属性被用来做偏移绘制阴影，所以不能使用CardView的padding属性，如果想设置CardView和其子View之间的边距，可使用setContentPadding(int, int, int, int)方法或对应的xml属性。</p>
</li>
<li><p>如果对CardView设置了明确的尺寸，因为阴影的缘故，其内容区域在Lollipop版本和之前的版本上显示不同，你可以通过不同系统版本使用不同资源值或设置useCompatPadding属性为true的方式来避免此问题。</p>
</li>
<li><p>通过setCardElevation(float)以兼容的方式设置CardView的elevation,CardView会使用Lollipop下或之前版本下的elevation API，进而改变阴影的尺寸。为防止改变阴影尺寸时，view发生移动，阴影大小不会超过MaxCardElevation，如果想在CardView初始化后动态改变阴影大小，应使用setMaxCardElevation(float)方法。</p>
</li>
</ul>
<h2 id="解剖源码。"><a href="#解剖源码。" class="headerlink" title="解剖源码。"></a>解剖源码。</h2><p>结构图如下：</p>
<div align="center"><br><img src="http://ohe81rx2w.bkt.clouddn.com/cardview_uml.png" alt=""><br></div>

<p>CardView内部根据不同版本系统实例化对应的CardViewImpl对象，CardViewImpl对象通过CardViewDelegate对象与CardView交互。</p>
<p>CardView的静态代码块中根据系统版本实例化对应的实现。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">       <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">21</span>) &#123;</div><div class="line">           IMPL = <span class="keyword">new</span> CardViewApi21();</div><div class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">17</span>) &#123;</div><div class="line">           IMPL = <span class="keyword">new</span> CardViewJellybeanMr1();</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           IMPL = <span class="keyword">new</span> CardViewGingerbread();</div><div class="line">       &#125;</div><div class="line">       IMPL.initStatic();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>这里调用了initStatic()，API21中即CardViewApi21类中是空实现，API17中实现如下（CardViewJellybeanMr1）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initStatic</span><span class="params">()</span> </span>&#123;</div><div class="line">        RoundRectDrawableWithShadow.sRoundRectHelper</div><div class="line">                = <span class="keyword">new</span> RoundRectDrawableWithShadow.RoundRectHelper() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRoundRect</span><span class="params">(Canvas canvas, RectF bounds, <span class="keyword">float</span> cornerRadius,</span></span></div><div class="line">                    Paint paint) &#123;</div><div class="line">                canvas.drawRoundRect(bounds, cornerRadius, cornerRadius, paint);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>API17之前的版本实现如下（CardViewGingerbread）：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initStatic</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//使用7步绘制操作来绘制出圆角矩形，在API17之前的版本此种方式要比canvas.drawRoundRect快,</span></div><div class="line">        <span class="comment">//因为API 11-16使用了alpha蒙版纹理去绘制</span></div><div class="line">        RoundRectDrawableWithShadow.sRoundRectHelper =</div><div class="line">                <span class="keyword">new</span> RoundRectDrawableWithShadow.RoundRectHelper() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawRoundRect</span><span class="params">(Canvas canvas, RectF bounds, <span class="keyword">float</span> cornerRadius,</span></span></div><div class="line">                    Paint paint) &#123;</div><div class="line">                <span class="keyword">final</span> <span class="keyword">float</span> twoRadius = cornerRadius * <span class="number">2</span>;</div><div class="line">                <span class="keyword">final</span> <span class="keyword">float</span> innerWidth = bounds.width() - twoRadius - <span class="number">1</span>;</div><div class="line">                <span class="keyword">final</span> <span class="keyword">float</span> innerHeight = bounds.height() - twoRadius - <span class="number">1</span>;</div><div class="line">                <span class="keyword">if</span> (cornerRadius &gt;= <span class="number">1f</span>) &#123;</div><div class="line">                    <span class="comment">// increment corner radius to account for half pixels.</span></div><div class="line">                    <span class="keyword">float</span> roundedCornerRadius = cornerRadius + .<span class="number">5f</span>;</div><div class="line">                    sCornerRect.set(-roundedCornerRadius, -roundedCornerRadius, roundedCornerRadius,</div><div class="line">                            roundedCornerRadius);</div><div class="line">                    <span class="keyword">int</span> saved = canvas.save();</div><div class="line">                    canvas.translate(bounds.left + roundedCornerRadius,</div><div class="line">                            bounds.top + roundedCornerRadius);</div><div class="line">                    canvas.drawArc(sCornerRect, <span class="number">180</span>, <span class="number">90</span>, <span class="keyword">true</span>, paint);</div><div class="line">                    canvas.translate(innerWidth, <span class="number">0</span>);</div><div class="line">                    canvas.rotate(<span class="number">90</span>);</div><div class="line">                    canvas.drawArc(sCornerRect, <span class="number">180</span>, <span class="number">90</span>, <span class="keyword">true</span>, paint);</div><div class="line">                    canvas.translate(innerHeight, <span class="number">0</span>);</div><div class="line">                    canvas.rotate(<span class="number">90</span>);</div><div class="line">                    canvas.drawArc(sCornerRect, <span class="number">180</span>, <span class="number">90</span>, <span class="keyword">true</span>, paint);</div><div class="line">                    canvas.translate(innerWidth, <span class="number">0</span>);</div><div class="line">                    canvas.rotate(<span class="number">90</span>);</div><div class="line">                    canvas.drawArc(sCornerRect, <span class="number">180</span>, <span class="number">90</span>, <span class="keyword">true</span>, paint);</div><div class="line">                    canvas.restoreToCount(saved);</div><div class="line">                    <span class="comment">//绘制上下两部分</span></div><div class="line">                    canvas.drawRect(bounds.left + roundedCornerRadius - <span class="number">1f</span>, bounds.top,</div><div class="line">                            bounds.right - roundedCornerRadius + <span class="number">1f</span>,</div><div class="line">                            bounds.top + roundedCornerRadius, paint);</div><div class="line"></div><div class="line">                    canvas.drawRect(bounds.left + roundedCornerRadius - <span class="number">1f</span>,</div><div class="line">                            bounds.bottom - roundedCornerRadius,</div><div class="line">                            bounds.right - roundedCornerRadius + <span class="number">1f</span>, bounds.bottom, paint);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// 绘制中间部分</span></div><div class="line">                canvas.drawRect(bounds.left, bounds.top + cornerRadius,</div><div class="line">                        bounds.right, bounds.bottom - cornerRadius , paint);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>API17和之前版本的阴影实现差异主要在这里，因为效率问题，API17之前的版本使用分步绘制测方式绘制圆角矩形。</p>
<p>CardView的构造器中会调用initialize(…),该方法中主要拿到各属性，然后调用具体实现的初始化方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CardView, defStyleAttr,</div><div class="line">                R.style.CardView);</div><div class="line">        ColorStateList backgroundColor;</div><div class="line">        <span class="keyword">if</span> (a.hasValue(R.styleable.CardView_cardBackgroundColor)) &#123;</div><div class="line">            backgroundColor = a.getColorStateList(R.styleable.CardView_cardBackgroundColor);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 没有设置背景则从当前主题中提取</span></div><div class="line">            <span class="keyword">final</span> TypedArray aa = getContext().obtainStyledAttributes(COLOR_BACKGROUND_ATTR);</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> themeColorBackground = aa.getColor(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            aa.recycle();</div><div class="line"></div><div class="line">            <span class="comment">//若主题中的colorBackground是浅色,使用cardview_light_background,否则使用cardview_dark_background</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">float</span>[] hsv = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">3</span>];</div><div class="line">            Color.colorToHSV(themeColorBackground, hsv);</div><div class="line">            backgroundColor = ColorStateList.valueOf(hsv[<span class="number">2</span>] &gt; <span class="number">0.5f</span></div><div class="line">                    ? getResources().getColor(R.color.cardview_light_background)</div><div class="line">                    : getResources().getColor(R.color.cardview_dark_background));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">float</span> radius = a.getDimension(R.styleable.CardView_cardCornerRadius, <span class="number">0</span>);</div><div class="line">      	...</div><div class="line">        mUserSetMinHeight = a.getDimensionPixelSize(R.styleable.CardView_android_minHeight, <span class="number">0</span>);</div><div class="line">        a.recycle();</div><div class="line"></div><div class="line">        IMPL.initialize(mCardViewDelegate, context, backgroundColor, radius,</div><div class="line">                elevation, maxElevation);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>接下来我们带着问题来看源码。</p>
<ol>
<li>API19之前版本如何实现阴影？</li>
<li>API19及以上版本如何实现View裁切？</li>
<li>API19及之后版本如何实现阴影？</li>
<li>API19之前版本cardPreventConrerOverlap属性的影响？</li>
<li>API19及以上版本受cardUseCompatPadding属性的影响？</li>
<li>为什么阴影在在x轴方向和y轴方向发生了位移，而不是均匀分布在view四周？</li>
</ol>
<h3 id="问题1：API19之前版本如何实现阴影？"><a href="#问题1：API19之前版本如何实现阴影？" class="headerlink" title="问题1：API19之前版本如何实现阴影？"></a>问题1：API19之前版本如何实现阴影？</h3><p>接下来我们先看API19之前是怎么实现阴影的(CardViewGingerbread类)。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(CardViewDelegate cardView, Context context,</span></span></div><div class="line">           ColorStateList backgroundColor, <span class="keyword">float</span> radius, <span class="keyword">float</span> elevation, <span class="keyword">float</span> maxElevation) &#123;</div><div class="line">       RoundRectDrawableWithShadow background = createBackground(context, backgroundColor, radius,</div><div class="line">               elevation, maxElevation);</div><div class="line">       background.setAddPaddingForCorners(cardView.getPreventCornerOverlap());</div><div class="line">       cardView.setCardBackground(background);</div><div class="line">       updatePadding(cardView);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>看来它的阴影是由RoundRectDrawableWithShadow类来实现的。<br>我们来看看来它的阴影是由RoundRectDrawableWithShadow类来实现的onDraw,第一次调用要走buildComponents方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mDirty) &#123;</div><div class="line">            buildComponents(getBounds());</div><div class="line">            mDirty = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">        canvas.translate(<span class="number">0</span>, mRawShadowSize / <span class="number">2</span>);</div><div class="line">        drawShadow(canvas);</div><div class="line">        canvas.translate(<span class="number">0</span>, -mRawShadowSize / <span class="number">2</span>);</div><div class="line">        sRoundRectHelper.drawRoundRect(canvas, mCardBounds, mCornerRadius, mPaint);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>buildComponents方法中，mRawMaxShadowSize其实就是maxElevation，此处确定了cardview的边界，上下左右都进行了偏移，空出来的区域是为了绘制阴影。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildComponents</span><span class="params">(Rect bounds)</span> </span>&#123;</div><div class="line">      <span class="comment">// Card is offset SHADOW_MULTIPLIER * maxShadowSize to account for the shadow shift.</span></div><div class="line">      <span class="comment">// We could have different top-bottom offsets to avoid extra gap above but in that case</span></div><div class="line">      <span class="comment">// center aligning Views inside the CardView would be problematic.</span></div><div class="line">      <span class="keyword">final</span> <span class="keyword">float</span> verticalOffset = mRawMaxShadowSize * SHADOW_MULTIPLIER;</div><div class="line">      mCardBounds.set(bounds.left + mRawMaxShadowSize, bounds.top+verticalOffset,</div><div class="line">              bounds.right - mRawMaxShadowSize, bounds.bottom - verticalOffset);</div><div class="line"></div><div class="line">      buildShadowCorners();</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>buildShadowCorners方法中初始化了绘制边阴影和角阴影的path。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildShadowCorners</span><span class="params">()</span> </span>&#123;</div><div class="line">        RectF innerBounds = <span class="keyword">new</span> RectF(-mCornerRadius, -mCornerRadius, mCornerRadius, mCornerRadius);</div><div class="line">        RectF outerBounds = <span class="keyword">new</span> RectF(innerBounds);</div><div class="line">        outerBounds.inset(-mShadowSize, -mShadowSize);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mCornerShadowPath == <span class="keyword">null</span>) &#123;</div><div class="line">            mCornerShadowPath = <span class="keyword">new</span> Path();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mCornerShadowPath.reset();</div><div class="line">        &#125;</div><div class="line">        mCornerShadowPath.setFillType(Path.FillType.EVEN_ODD);</div><div class="line">        mCornerShadowPath.moveTo(-mCornerRadius, <span class="number">0</span>);</div><div class="line">        mCornerShadowPath.rLineTo(-mShadowSize, <span class="number">0</span>);</div><div class="line">        <span class="comment">// outer arc</span></div><div class="line">        mCornerShadowPath.arcTo(outerBounds, <span class="number">180f</span>, <span class="number">90f</span>, <span class="keyword">false</span>);</div><div class="line">        <span class="comment">// inner arc</span></div><div class="line">        mCornerShadowPath.arcTo(innerBounds, <span class="number">270f</span>, -<span class="number">90f</span>, <span class="keyword">false</span>);</div><div class="line">        mCornerShadowPath.close();</div><div class="line">        <span class="keyword">float</span> startRatio = mCornerRadius / (mCornerRadius + mShadowSize);</div><div class="line">        mCornerShadowPaint.setShader(<span class="keyword">new</span> RadialGradient(<span class="number">0</span>, <span class="number">0</span>, mCornerRadius + mShadowSize,</div><div class="line">                <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;mShadowStartColor, mShadowStartColor, mShadowEndColor&#125;,</div><div class="line">                <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;<span class="number">0f</span>, startRatio, <span class="number">1f</span>&#125;</div><div class="line">                , Shader.TileMode.CLAMP));</div><div class="line"></div><div class="line">        <span class="comment">// we offset the content shadowSize/2 pixels up to make it more realistic.</span></div><div class="line">        <span class="comment">// this is why edge shadow shader has some extra space</span></div><div class="line">        <span class="comment">// When drawing bottom edge shadow, we use that extra space.</span></div><div class="line">        mEdgeShadowPaint.setShader(<span class="keyword">new</span> LinearGradient(<span class="number">0</span>, -mCornerRadius + mShadowSize, <span class="number">0</span>,</div><div class="line">                -mCornerRadius - mShadowSize,</div><div class="line">                <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;mShadowStartColor, mShadowStartColor, mShadowEndColor&#125;,</div><div class="line">                <span class="keyword">new</span> <span class="keyword">float</span>[]&#123;<span class="number">0f</span>, .<span class="number">5f</span>, <span class="number">1f</span>&#125;, Shader.TileMode.CLAMP));</div><div class="line">        mEdgeShadowPaint.setAntiAlias(<span class="keyword">false</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>接下来看drawShadow方法，这里基本的canvas操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawShadow</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> edgeShadowTop = -mCornerRadius - mShadowSize;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> inset = mCornerRadius + mInsetShadow + mRawShadowSize / <span class="number">2</span>;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> drawHorizontalEdges = mCardBounds.width() - <span class="number">2</span> * inset &gt; <span class="number">0</span>;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> drawVerticalEdges = mCardBounds.height() - <span class="number">2</span> * inset &gt; <span class="number">0</span>;</div><div class="line">        <span class="comment">// LT</span></div><div class="line">        <span class="keyword">int</span> saved = canvas.save();</div><div class="line">        canvas.translate(mCardBounds.left + inset, mCardBounds.top + inset);</div><div class="line">        canvas.drawPath(mCornerShadowPath, mCornerShadowPaint);</div><div class="line">        <span class="keyword">if</span> (drawHorizontalEdges) &#123;</div><div class="line">            canvas.drawRect(<span class="number">0</span>, edgeShadowTop,</div><div class="line">                    mCardBounds.width() - <span class="number">2</span> * inset, -mCornerRadius,</div><div class="line">                    mEdgeShadowPaint);</div><div class="line">        &#125;</div><div class="line">        canvas.restoreToCount(saved);</div><div class="line">        <span class="comment">// RB</span></div><div class="line">        saved = canvas.save();</div><div class="line">        canvas.translate(mCardBounds.right - inset, mCardBounds.bottom - inset);</div><div class="line">        canvas.rotate(<span class="number">180f</span>);</div><div class="line">        canvas.drawPath(mCornerShadowPath, mCornerShadowPaint);</div><div class="line">        <span class="keyword">if</span> (drawHorizontalEdges) &#123;</div><div class="line">            canvas.drawRect(<span class="number">0</span>, edgeShadowTop,</div><div class="line">                    mCardBounds.width() - <span class="number">2</span> * inset, -mCornerRadius + mShadowSize,</div><div class="line">                    mEdgeShadowPaint);</div><div class="line">        &#125;</div><div class="line">        canvas.restoreToCount(saved);</div><div class="line">        <span class="comment">// LB</span></div><div class="line">        saved = canvas.save();</div><div class="line">        canvas.translate(mCardBounds.left + inset, mCardBounds.bottom - inset);</div><div class="line">        canvas.rotate(<span class="number">270f</span>);</div><div class="line">        canvas.drawPath(mCornerShadowPath, mCornerShadowPaint);</div><div class="line">        <span class="keyword">if</span> (drawVerticalEdges) &#123;</div><div class="line">            canvas.drawRect(<span class="number">0</span>, edgeShadowTop,</div><div class="line">                    mCardBounds.height() - <span class="number">2</span> * inset, -mCornerRadius, mEdgeShadowPaint);</div><div class="line">        &#125;</div><div class="line">        canvas.restoreToCount(saved);</div><div class="line">        <span class="comment">// RT</span></div><div class="line">        saved = canvas.save();</div><div class="line">        canvas.translate(mCardBounds.right - inset, mCardBounds.top + inset);</div><div class="line">        canvas.rotate(<span class="number">90f</span>);</div><div class="line">        canvas.drawPath(mCornerShadowPath, mCornerShadowPaint);</div><div class="line">        <span class="keyword">if</span> (drawVerticalEdges) &#123;</div><div class="line">            canvas.drawRect(<span class="number">0</span>, edgeShadowTop,</div><div class="line">                    mCardBounds.height() - <span class="number">2</span> * inset, -mCornerRadius, mEdgeShadowPaint);</div><div class="line">        &#125;</div><div class="line">        canvas.restoreToCount(saved);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>可见API19之前阴影的实现是由canvas+path+RadialGradient绘制角阴影,canvas+path+LinearGradient绘制边阴影。</p>
<h3 id="问题2：API19及以上版本如何实现View裁切？"><a href="#问题2：API19及以上版本如何实现View裁切？" class="headerlink" title="问题2：API19及以上版本如何实现View裁切？"></a>问题2：API19及以上版本如何实现View裁切？</h3><p>进入CardViewApi21类，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(CardViewDelegate cardView, Context context,</span></span></div><div class="line">                           ColorStateList backgroundColor, <span class="keyword">float</span> radius, <span class="keyword">float</span> elevation, <span class="keyword">float</span> maxElevation) &#123;</div><div class="line">        <span class="keyword">final</span> RoundRectDrawable background = <span class="keyword">new</span> RoundRectDrawable(backgroundColor, radius);</div><div class="line">        cardView.setCardBackground(background);</div><div class="line"></div><div class="line">        View view = cardView.getCardView();</div><div class="line">        view.setClipToOutline(<span class="keyword">true</span>);</div><div class="line">        view.setElevation(elevation);</div><div class="line">        setMaxElevation(cardView, maxElevation);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>这里实例化了RoundRectDrawable作为cardview的背景。RoundRectDrawable是用来绘制背景圆角矩形，<br> cardView.getCardView()拿到了CardView对象，前面我们说了CardView是继承自FrameLayout的，所以CardView即是ViewGroup也是View,view.setClipToOutline(true)是什么意思呢？</p>
<p><strong>android5.0之后允许自定义视图阴影与轮廓</strong><br>视图的背景可绘制对象的边界将决定其阴影的默认形状。轮廓代表图形对象的外形并定义触摸反馈的波纹区域。</p>
<p>下面举一个以背景可绘制对象定义的视图示例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/myview"</span></div><div class="line">    <span class="attr">...</span></div><div class="line">    <span class="attr">android:elevation</span>=<span class="string">"2dp"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/myrect"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>背景可绘制对象被定义为一个拥有圆角的矩形：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- res/drawable/myrect.xml --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">       <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#42000000"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"5dp"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>视图将投射一个带有圆角的阴影，因为背景可绘制对象将定义视图的轮廓。 如果提供一个自定义轮廓，则此轮廓将替换视图阴影的默认形状。</p>
<p>如果要为代码中的视图定义自定义轮廓：<br>扩展 ViewOutlineProvider 类别。<br>替代 getOutline() 方法。<br>利用 View.setOutlineProvider() 方法向您的视图指定新的轮廓提供程序。<br>您可使用 Outline 类别中的方法创建带有圆角的椭圆形和矩形轮廓。视图的默认轮廓提供程序将从视图背景取得轮廓。 如果要防止视图投射阴影，请将其轮廓提供程序设置为 null。</p>
<p><strong>裁剪视图</strong><br>裁剪视图让您能够轻松改变视图形状。您可以裁剪视图，以便与其他设计元素保持一致，也可以根据用户输入改变视图形状。您可使用 View.setClipToOutline() 方法或 android:clipToOutline 属性将视图裁剪至其轮廓区域。 由 Outline.canClip() 方法所决定，仅有矩形、圆形和圆角矩形轮廓支持裁剪。</p>
<p>如果要将视图裁剪至可绘制对象的形状，请将可绘制对象设置为视图背景（如上所示）并调用 View.setClipToOutline() 方法。</p>
<h3 id="问题3：-API19及之后版本如何实现阴影？"><a href="#问题3：-API19及之后版本如何实现阴影？" class="headerlink" title="问题3： API19及之后版本如何实现阴影？"></a>问题3： API19及之后版本如何实现阴影？</h3><p>CardViewApi21的initialize方法中调用了view.setElevation(elevation),<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setElevation</span><span class="params">(<span class="keyword">float</span> elevation)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (elevation != getElevation()) &#123;</div><div class="line">            invalidateViewProperty(<span class="keyword">true</span>, <span class="keyword">false</span>);</div><div class="line">            mRenderNode.setElevation(elevation);</div><div class="line">            invalidateViewProperty(<span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">            invalidateParentIfNeededAndWasQuickRejected();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>再看mRenderNode.setElevation(elevation);<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">	 public boolean setElevation(float lift) &#123;</div><div class="line">        return nSetElevation(mNativeRenderNode, lift);</div><div class="line">    &#125;</div><div class="line">```	</div><div class="line">nSetElevation(mNativeRenderNode, lift)是个native方法，由此可见android5.0开始所有的view都可以显示阴影，而且是根据elevation属性直接有native方法来实现。</div><div class="line"></div><div class="line">android5.0开始因为加入了Material Design,Material Design 为 UI 元素引入高度，为View加上了Z属性。</div><div class="line"></div><div class="line">由 Z 属性所表示的视图高度将决定其阴影的视觉外观：拥有较高 Z 值的视图将投射更大且更柔和的阴影。 拥有较高 Z 值的视图将挡住拥有较低 Z 值的视图；不过视图的 Z 值并不影响视图的大小。</div><div class="line"></div><div class="line">视图的 Z 值包含两个组件：</div><div class="line"></div><div class="line">高度：静态组件。</div><div class="line">转换：用于动画的动态组件。</div><div class="line">Z = elevation + translationZ</div><div class="line"></div><div class="line">所以影响View阴影的因素有两个elevation和translationZ.</div><div class="line">在 Material Design Guidelines 中有建议卡片、按钮这类元素触摸时应当有一个浮起的效果，也就是增大 Z 轴位移,我们怎么实现这个效果呢？</div><div class="line">&lt;div align=center&gt;</div><div class="line">&lt;img src="http://ohe81rx2w.bkt.clouddn.com/1445743952107919.gif"  alt=""/&gt;</div><div class="line">&lt;/div&gt;</div><div class="line"></div><div class="line">只需要借助 Lollipop 的一个新属性 android:stateListAnimator，创建一个 TranslationZ 的变换动画放在 /res/anim,自己取一个名（如 touch_raise.xml），加入以下内容：</div><div class="line">```xml</div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;selector xmlns:android="http://schemas.android.com/apk/res/android"&gt;</div><div class="line">	&lt;item android:state_enabled="true" android:state_pressed="true"&gt;</div><div class="line">		&lt;objectAnimator</div><div class="line">		android:duration="@android:integer/config_shortAnimTime"</div><div class="line">		android:propertyName="translationZ"</div><div class="line">		android:valueTo="@dimen/touch_raise"</div><div class="line">		android:valueType="floatType" /&gt;</div><div class="line">	&lt;/item&gt;</div><div class="line">	&lt;item&gt;</div><div class="line">		&lt;objectAnimator</div><div class="line">		android:duration="@android:integer/config_shortAnimTime"</div><div class="line">		android:propertyName="translationZ"</div><div class="line">		android:valueTo="0dp"</div><div class="line">		android:valueType="floatType" /&gt;</div><div class="line">	&lt;/item&gt;</div><div class="line">&lt;/selector&gt;</div></pre></td></tr></table></figure></p>
<p>然后为你需要添加效果的 CardView（其他 View 同理）所在的 Layout XML 复制多一份到 /res/layout-v21，然后在新的那份 XML 的 CardView 中加入属性 android:stateListAnimator=”@anim/touch_raise”。这样，你的卡片按住时就会有浮起（阴影加深）的效果了。<br>至于波纹效果只需要给CardView加上android:foreground=”?attr/selectableItemBackground” 属性即可。</p>
<h3 id="问题4：API19之前版本cardPreventConrerOverlap属性的影响？"><a href="#问题4：API19之前版本cardPreventConrerOverlap属性的影响？" class="headerlink" title="问题4：API19之前版本cardPreventConrerOverlap属性的影响？"></a>问题4：API19之前版本cardPreventConrerOverlap属性的影响？</h3><p>CardView的setPreventCornerOverlap方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPreventCornerOverlap</span><span class="params">(<span class="keyword">boolean</span> preventCornerOverlap)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (preventCornerOverlap != mPreventCornerOverlap) &#123;</div><div class="line">          mPreventCornerOverlap = preventCornerOverlap;</div><div class="line">          IMPL.onPreventCornerOverlapChanged(mCardViewDelegate);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>然后看CardViewGingerbread的onPreventCornerOverlapChanged方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPreventCornerOverlapChanged</span><span class="params">(CardViewDelegate cardView)</span> </span>&#123;</div><div class="line">       getShadowBackground(cardView).setAddPaddingForCorners(cardView.getPreventCornerOverlap());</div><div class="line">       updatePadding(cardView);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>一路跟踪下来，发现关键点在RoundRectDrawableWithShadow中，addPaddingForCorners即为传过来的preventCornerOverlap，当preventCornerOverlap为true时，内边距增加了(1 - COS_45) * cornerRadius)，这样CardView的子View就不会和圆角重叠了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">float</span> <span class="title">calculateVerticalPadding</span><span class="params">(<span class="keyword">float</span> maxShadowSize, <span class="keyword">float</span> cornerRadius,</span></span></div><div class="line">                                          <span class="keyword">boolean</span> addPaddingForCorners) &#123;</div><div class="line">        <span class="keyword">if</span> (addPaddingForCorners) &#123;</div><div class="line">            <span class="keyword">return</span> (<span class="keyword">float</span>) (maxShadowSize * SHADOW_MULTIPLIER + (<span class="number">1</span> - COS_45) * cornerRadius);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> maxShadowSize * SHADOW_MULTIPLIER;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="问题5-API19及以上版本受cardUseCompatPadding属性的影响？"><a href="#问题5-API19及以上版本受cardUseCompatPadding属性的影响？" class="headerlink" title="问题5  API19及以上版本受cardUseCompatPadding属性的影响？"></a>问题5  API19及以上版本受cardUseCompatPadding属性的影响？</h3><p>CardView的setUseCompatPadding方法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUseCompatPadding</span><span class="params">(<span class="keyword">boolean</span> useCompatPadding)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (mCompatPadding != useCompatPadding) &#123;</div><div class="line">          mCompatPadding = useCompatPadding;</div><div class="line">          IMPL.onCompatPaddingChanged(mCardViewDelegate);</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>进入CardViewApi21。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompatPaddingChanged</span><span class="params">(CardViewDelegate cardView)</span> </span>&#123;</div><div class="line">       setMaxElevation(cardView, getMaxElevation(cardView));</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>最后跟踪到RoundRectDrawable,这里的mInsetForPadding就是cardUseCompatPadding属性的值，当cardUseCompatPadding属性为true时，会设置内边距，calculateVerticalPadding和calculateHorizontalPadding方法是RoundRectDrawableWithShadow的静态方法，如此5.0和之前版本就具有相同的内边距计算方式了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateBounds</span><span class="params">(Rect bounds)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (bounds == <span class="keyword">null</span>) &#123;</div><div class="line">            bounds = getBounds();</div><div class="line">        &#125;</div><div class="line">        mBoundsF.set(bounds.left, bounds.top, bounds.right, bounds.bottom);</div><div class="line">        mBoundsI.set(bounds);</div><div class="line">        <span class="keyword">if</span> (mInsetForPadding) &#123;</div><div class="line">            <span class="keyword">float</span> vInset = calculateVerticalPadding(mPadding, mRadius, mInsetForRadius);</div><div class="line">            <span class="keyword">float</span> hInset = calculateHorizontalPadding(mPadding, mRadius, mInsetForRadius);</div><div class="line">            mBoundsI.inset((<span class="keyword">int</span>) Math.ceil(hInset), (<span class="keyword">int</span>) Math.ceil(vInset));</div><div class="line">            <span class="comment">// to make sure they have same bounds.</span></div><div class="line">            mBoundsF.set(mBoundsI);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>在CardViewApi21的updatePadding方法也可以看到，如果不设置cardUseCompatPadding,其阴影内边距为0，这也就解释了前文中的现象。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePadding</span><span class="params">(CardViewDelegate cardView)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!cardView.getUseCompatPadding()) &#123;</div><div class="line">            cardView.setShadowPadding(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">float</span> elevation = getMaxElevation(cardView);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> radius = getRadius(cardView);</div><div class="line">        <span class="keyword">int</span> hPadding = (<span class="keyword">int</span>) Math.ceil(RoundRectDrawableWithShadow</div><div class="line">                .calculateHorizontalPadding(elevation, radius, cardView.getPreventCornerOverlap()));</div><div class="line">        <span class="keyword">int</span> vPadding = (<span class="keyword">int</span>) Math.ceil(RoundRectDrawableWithShadow</div><div class="line">                .calculateVerticalPadding(elevation, radius, cardView.getPreventCornerOverlap()));</div><div class="line">        cardView.setShadowPadding(hPadding, vPadding, hPadding, vPadding);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="问题6-为什么阴影在在x轴方向和y轴方向发生了位移，而不是均匀分布在view四周？"><a href="#问题6-为什么阴影在在x轴方向和y轴方向发生了位移，而不是均匀分布在view四周？" class="headerlink" title="问题6  为什么阴影在在x轴方向和y轴方向发生了位移，而不是均匀分布在view四周？"></a>问题6  为什么阴影在在x轴方向和y轴方向发生了位移，而不是均匀分布在view四周？</h3><p>在RoundRectDrawableWithShadow的draw方法中，我们看到，在绘制阴影前，画布向y轴正方向进行了位移，这就使得阴影的方向发生了变化。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (mDirty) &#123;</div><div class="line">           buildComponents(getBounds());</div><div class="line">           mDirty = <span class="keyword">false</span>;</div><div class="line">       &#125;</div><div class="line">       canvas.translate(<span class="number">0</span>, mRawShadowSize / <span class="number">2</span>);</div><div class="line">       drawShadow(canvas);</div><div class="line">       canvas.translate(<span class="number">0</span>, -mRawShadowSize / <span class="number">2</span>);</div><div class="line">       sRoundRectHelper.drawRoundRect(canvas, mCardBounds, mCornerRadius, mPaint);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>如果项目的设计符合Material Design，那最好，如果设计有一天让你实现四周带相同尺寸阴影的效果呢？我们也知道怎么做了吧！<br>这里我把实现方式放到<a href="https://github.com/Proton626/FakeCardView" target="_blank" rel="external">Github</a>上了，有需要欢迎关注。</p>
<p> 参考资料：<br><a href="https://developer.android.com/training/material/lists-cards.html#Dependencies" target="_blank" rel="external">https://developer.android.com/training/material/lists-cards.html#Dependencies</a><br><a href="http://www.jianshu.com/p/33b1d21d6ba6" target="_blank" rel="external">http://www.jianshu.com/p/33b1d21d6ba6</a><br><a href="https://developer.android.com/training/material/shadows-clipping.html#Shadows" target="_blank" rel="external">https://developer.android.com/training/material/shadows-clipping.html#Shadows</a><br><a href="https://android.jlelse.eu/android-card-view-edb905e67cd6" target="_blank" rel="external">https://android.jlelse.eu/android-card-view-edb905e67cd6</a><br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1025/3621.html" target="_blank" rel="external">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1025/3621.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/17/aboutme/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/17/aboutme/" itemprop="url">人生就像一盒巧克力：About me.</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-17T09:49:28+08:00">
                2017-07-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随心记/" itemprop="url" rel="index">
                    <span itemprop="name">随心记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/17/aboutme/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/07/17/aboutme/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/07/17/aboutme/" class="leancloud_visitors" data-flag-title="人生就像一盒巧克力：About me.">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://image.135editor.com/files/users/253/2537090/201707/XnwZsGz5_Sx2p.jpg" alt=""></p>
<p>90后程序猿，感觉这个搭配有点绝情，为什么这么说呢？有人说90后垮掉的一代，有人说程序猿是吃青春饭，是不是有点同情我，但我要说这个世界最不缺就是偏见，时间会证明一切。</p>
<p>在大厂当过螺丝钉，也在小创挑过大梁，俗话说干一行爱一行，但我觉得我是爱一行干一行，沉迷代码无药可救，如果可怜我，介绍个对象也是可以的，嘿嘿。</p>
<p>吊车尾211本科一枚，非科班出身，当然我也是有外企工作经历的，在世界500强干过，肯德基后厨做汉堡，难忘的经历，发过传单干过销售，做过遥感数据处理，现在专心写代码，具体点就是Android程序猿，但我向来认为软件工程师就不能定义的那么狭隘，如果老板今天让我去后台写Python，我敢说不吗？当然上啊！</p>
<p>有幸共事过的人有斯坦福大牛、名校硕博，当然还有法语专业转来搬砖的，接触的人越多越觉得自己渺小，越能客观的与人相处，感觉人也是符合冰山理论的，仅靠水面上的一角来下定论是有偏颇的。发现大家经常喜欢下意识地拿薪水来界定程序猿地技术水平，薪资一定程度会显示技术但并不是绝对的，行内人都懂的，展开来讲就啰嗦了。</p>
<p><img src="http://image.135editor.com/files/users/253/2537090/201707/q9WpmjCC_Wj84.jpg" alt=""></p>
<p>程序猿不等于屌丝，当然前提是资产不是界定屌丝的标准。</p>
<p>除了代码我还喜欢健身，目前身上的腱子肉也是很可观的，有机会爆照，哈哈，欢迎交流。</p>
<p>猫瘾晚期，一天不撸猫就喘不过气睡不着觉，目前家中供养着一只英短蓝猫，偶尔指点我写代码，这些代码若被老板看见，估计我得被叫去问话了:公司雇你来是写bug的吗？</p>
<p>“财迷”一个，此处指的理财，人的收入是分为两部分的，主动收入和被动收入，要想实现财务自由不理财怎么能行，互金、基金、股票等，欢迎交流经验，就像老罗说的，知识要做爱才能产生新的灵感。</p>
<p>个人公众号上可能会发技术分享、职场感悟、理财相关等等，欢迎关注我，也欢迎和我互动，如果觉得我是贱人就是矫情，随时取关也是可以的，如果不嫌麻烦给我发个消息埋汰一两句，也是OK的。<br><br></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/14/APP复杂列表数据解析的一个小技巧/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/APP复杂列表数据解析的一个小技巧/" itemprop="url">APP复杂列表数据解析的一个小技巧</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T17:27:29+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/14/APP复杂列表数据解析的一个小技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/07/14/APP复杂列表数据解析的一个小技巧/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/07/14/APP复杂列表数据解析的一个小技巧/" class="leancloud_visitors" data-flag-title="APP复杂列表数据解析的一个小技巧">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://image.135editor.com/files/users/253/2537090/201707/vrhE2OwH_G6Gx.jpg" alt=""></p>
<blockquote>
<p>最近遇到个小问题，不是什么技术难点，但也是种思路嘛！分享出来给大家看看。</p>
</blockquote>
<p>相信大家都做过复杂类型的列表页，一般APP的首页都是这样的。</p>
<p>服务器返回的是json数据，我们可以通过Fastjson或Gson直接将json字符串转换为对应的java bean即可，java由于是强类型的，所以必须实现定义好类型，我们来看个例子：<br>假如服务器返回的数据是这样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;</div><div class="line">		“type&quot; = 1</div><div class="line">		&quot;a&quot;     =&#123;...&#125;</div><div class="line">		&quot;b&quot;     =null</div><div class="line">		&quot;c&quot;     =null</div><div class="line">	&#125;</div><div class="line">	&#123;</div><div class="line">		“type&quot; = 2</div><div class="line">		&quot;b&quot;     =&#123;...&#125;</div><div class="line">		&quot;a&quot;     =null</div><div class="line">		&quot;c&quot;     =null</div><div class="line">	&#125;</div><div class="line">	&#123;</div><div class="line">		“type&quot; = 3</div><div class="line">		&quot;c&quot;     =&#123;...&#125;</div><div class="line">		&quot;a&quot;     =null</div><div class="line">		&quot;b&quot;     =null</div><div class="line">	&#125;</div><div class="line">	...</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>当然实际开发时数据要复杂得多。我们对应的首页的bean可以定义三个字段type、a、b，json数据转换为对象时，类型相对的字段就会被赋上值，列表时也可以根据类型来填充。</p>
<p>如果服务器返回的数据是这样呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;</div><div class="line">		&quot;type&quot; = 1</div><div class="line">		&quot;data&quot; =&#123;...&#125;</div><div class="line">	&#125;</div><div class="line">	&#123;</div><div class="line">		&quot;type&quot; = 3</div><div class="line">		&quot;data&quot; =&#123;...&#125;</div><div class="line">	&#125;</div><div class="line">	&#123;</div><div class="line">		&quot;type&quot; = 2</div><div class="line">		&quot;data&quot; =&#123;...&#125;</div><div class="line">	&#125;</div><div class="line">	...</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>这种情况就尴尬了，不同类型对应不同的bean，java的列表是只允许存放相同类型数据的，既然我们无法在json转换为对象时确定data的具体类型，那么可以这样定义bean:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">class Test&#123;</div><div class="line">	var type:Int = 0</div><div class="line">	var data:JsonObject? = null</div><div class="line">	</div><div class="line">	//再定义实际类型的字段</div><div class="line">	var a:A?=null</div><div class="line">		get()&#123;</div><div class="line">			val gson = Gson()</div><div class="line">            val jsonElement = jo!!.get(&quot;data&quot;).asJsonArray</div><div class="line">            return gson.fromJson(gson.toJson(jsonElement), object : TypeToken&lt;A&gt;&gt;() &#123;&#125;.type)</div><div class="line">		&#125;</div><div class="line">		var b:B?=null</div><div class="line">		get()&#123;</div><div class="line">			val gson = Gson()</div><div class="line">            val jsonElement = jo!!.get(&quot;data&quot;).asJsonArray</div><div class="line">            return gson.fromJson(gson.toJson(jsonElement), object : TypeToken&lt;B&gt;&gt;() &#123;&#125;.type)</div><div class="line">		&#125;</div><div class="line">		...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后你就可以拿着list:List\<test>愉快的填充列表了，只要你在渲染type=1时乖乖去拿对应的a字段就ok了，其他类似，当然如果有列表的也是同理。</test></p>
<p>retrofit添加Gson转换器直接将json转换为对象了，所以会有这种问题，当然你也可以直接根据key来操作返回的json串，方法有很多，你可以选择你喜欢的方式。</p>
<p>当然如果你可以让服务器哥们修改返回的数据结构也是可以的，前提是你要和IOS组的哥们串通好，不然容易被怼。如果你要更好的方式也欢迎和我交流。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/14/回顾过去，展望未来/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/14/回顾过去，展望未来/" itemprop="url">回顾过去展望未来</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-14T10:55:42+08:00">
                2017-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/随心记/" itemprop="url" rel="index">
                    <span itemprop="name">随心记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/14/回顾过去，展望未来/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/07/14/回顾过去，展望未来/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/07/14/回顾过去，展望未来/" class="leancloud_visitors" data-flag-title="回顾过去展望未来">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://image.135editor.com/files/users/253/2537090/201707/TntLRZLb_DkI2.jpg" alt=""></p>
<p>时间犹如白驹过隙，17年半年都过去了，还记得年初定的计划吗？现在的进展如何？当初信誓旦旦立下的承诺，如今是否还在坚持着。 所以我想写点文字，总结逝去的上半年，展望眼下的下半年。 这个公众号我开通也有段时间了，但直到最近才下定决心把它做下去，我想用它记录我的成长，同时做一些技术分享，虽然目前也没什么读者，但我相信我会慢慢结交到更多朋友的。 虽然现在做技术研发工作，具体点就是Android程序猿啦，但大学学的是地理专业，虽然是个211，但也就那样，感觉国内的大学除了985，其他学校都差不多吧！大学只不过是换个地方打游戏而已，还好我稍微有一点危机感，除了打游戏也规划了一下自己的职业方向。</p>
<p><img src="http://image.135editor.com/files/users/253/2537090/201707/q8DHTXHd_aA2M.jpg" alt=""></p>
<p>记得在校的时候，学校有游泳馆，但那时候去游泳馆完全是去洗澡的，游泳馆拿学生证收费比洗浴中心便宜，北方洗澡都是去公共澡堂的，但那时候想着反正都来了。为啥不学学游泳呢？于是和几个小伙伴一起约定学游泳，结果不到一个月就没剩几个人了，我还坚持着，那时候也没人教，就自己看视频琢磨，扑腾了两个月终于学会蛙泳了，那种成就感就像你的程序一次跑通了似的，非常棒，然后之后我就可以去深水区畅游了，再也不用在浅水区和小朋友大叔大妈们下饺子了，不过第一次下深水区还是挺紧张的，万事开头难，一旦你成功了一次，下次就很简单了。</p>
<p>还有两件事也在大学里坚持了两年，一是练跆拳道，而是学韩语。练过跆拳道的人都知道，跆拳道主要是腿功，需要高踢腿，所以每次必做的练习就是压腿，把腿筋膜拉开，要练成一字马那样，每次上完课基本都走不了路了，开始的那段时间，每次上厕所都费劲，酸爽的很。</p>
<p>大学空闲时间挺多的，平时我会打些工，大学生做兼职，无非就是做做家教，端端盘子，不过那时候我还在快餐店后厨做汉堡炸鸡，这个经历对我影响也蛮大的，那个快餐店在飞机场了，又一次飞机延误，有个团体来订餐，一次性点了200个汉堡，整个后厨忙的手忙脚乱的，我现在还印象深刻，那趟延误的飞机是飞往天津的。刚开始学做汉堡的时候，一站就是一天，也不敢坐着，背各种菜单，每种汉堡放什么酱，放菜的顺序等等，炸鸡的时间，乐薯鸡的做法等等，虽然都是流程化的东西，但东西很多也很杂，因为夜班基本后厨就一人，所以要求所有东西都会做，那时候店长怕冷，我值班的时候还得帮他去冷库清点货物，大冬天的进冷库，那感觉现在想想都想打冷颤，每天清洁后厨，换油神马的，总之就是累，但工资却很少，那时候我就下定决心一定要做一份自己喜欢的有利于个人成长的工作。</p>
<p>想想也挺佩服自己的，那时候打工挺忙的，好不容易挣点钱，除了给自己换新手机，剩下的就拿来交学费了，前文我也提到，还有一件坚持下来的事就是学韩语，有课的时候去上课，没课的时候就自己在看书做笔记，慢慢也学到中级了，最后和韩语老师一块儿吃饭的时候，都说能坚持下来也挺不容易的，因为他带过好多学生都没能坚持下来的。这都是课外的安排，正经专业的课程我学的不好也不差，主要是兴趣不是太大。</p>
<p><img src="http://image.135editor.com/files/users/253/2537090/201707/DuCUGpCX_xKuc.jpg" alt=""></p>
<p>后来也就是大二快大三的时候，我无意中接触到编程，就是在网上看黑客的教程什么的，然后慢慢开始研究，不得不说兴趣果然是最大的驱动力，那时候去图书馆借阅了好多编程的书，对着书敲代码，书上的例子一般没几个能立马运行的，然后还得自己调试，但运行成功的那一刻成就感慢慢的，然后撸码就成了我业余活动之一，想想宿舍里四个人，三个游戏打的热火朝天，一个人在那默默敲代码，当然我也不是自夸什么的，那时候也没想那么多，就是做自己喜欢的事呗，我也没有瞧不起别人什么的，与室友们关系也挺铁的，大家经常一起喝喝酒，吹吹牛逼什么的，不过在我的影响下，有好几个同学也入坑了，这里的经历就说来话长了，有机会再说。</p>
<p>可以说我是运气，但归根结底还是因为我有所准备，毕业之前就能找到报酬很可观的工作。</p>
<p>这里有两个道理我想分享给大家。机会往往垂青有所准备的人；很多时候我们只要咬牙坚持下来就可以打败所有的对手。</p>
<p>写着写着就啰嗦了，未完待续。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/16/仿360市场下载按钮/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="子质">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="子质’s Notes">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/16/仿360市场下载按钮/" itemprop="url">仿360市场下载按钮</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T10:40:11+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/16/仿360市场下载按钮/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2017/05/16/仿360市场下载按钮/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          
             <span id="/2017/05/16/仿360市场下载按钮/" class="leancloud_visitors" data-flag-title="仿360市场下载按钮">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看一下效果：<br><img src="http://ohe81rx2w.bkt.clouddn.com/360downloadView.gif" alt=""></p>
<p>无论多复杂的动画我们都是可以分割成小单元的，然后分步来实现。这个动画大概分为收缩，准备，加载，完成几个部分。为此定义一个枚举类来描述view的状态。<br><code>public enum Status {
        NORMAL, START, PRE, EXPAND, LOAD, END
    }</code></p>
<h3 id="收缩动画"><a href="#收缩动画" class="headerlink" title="收缩动画"></a>收缩动画</h3><p>使用动画不断改变圆角矩形的宽度，触发重绘。代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">private void initAnim() &#123;</div><div class="line">        Animation animation1 = new Animation() &#123;</div><div class="line">            @Override</div><div class="line">            protected void applyTransformation(float interpolatedTime, Transformation t) &#123;</div><div class="line">                mCurrLength = mWidth * (1 - interpolatedTime);</div><div class="line">                if (mCurrLength &lt; mHeight) &#123;</div><div class="line">                    mCurrLength = mHeight;</div><div class="line">                    clearAnimation();</div><div class="line">                    mAngleAnim.start();</div><div class="line">                &#125;</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        animation1.setDuration(mShrinkDuration);</div><div class="line">        animation1.setInterpolator(new LinearInterpolator());</div><div class="line">        animation1.setAnimationListener(new Animation.AnimationListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onAnimationStart(Animation animation) &#123;</div><div class="line">                mStatus = Status.START;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onAnimationEnd(Animation animation) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onAnimationRepeat(Animation animation) &#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        mShrinkAnim = animation1;</div><div class="line">		...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>onDraw中绘制：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if (mStatus == Status.START || mStatus == Status.NORMAL) &#123;</div><div class="line">    float left = (mWidth - mCurrLength) / 2f;</div><div class="line">    float right = (mWidth + mCurrLength) / 2f;</div><div class="line">    float r = mHeight / 2f;</div><div class="line">    canvas.drawRoundRect(new RectF(left, 0, right, mHeight), r, r, mBgPaint);</div><div class="line">    if (mStatus == Status.NORMAL) &#123;</div><div class="line">        Paint.FontMetrics fm = mTextPaint.getFontMetrics();</div><div class="line">        float y = mHeight / 2 + (fm.descent - fm.ascent) / 2 - fm.descent;</div><div class="line">        canvas.drawText(&quot;下载&quot;, mWidth / 2, y, mTextPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="准备动画"><a href="#准备动画" class="headerlink" title="准备动画"></a>准备动画</h3><p>此时旋转动画，是通过canvas绘制背景圆和三个小圆，然后不断旋转画布来实现的，具体求圆心坐标和角度动画我们直接看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">ValueAnimator animator = ValueAnimator.ofFloat(0, 1);</div><div class="line">       animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">           @Override</div><div class="line">           public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">               mAngle += mPreAnimSpeed;</div><div class="line">               invalidate();</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator.addListener(new Animator.AnimatorListener() &#123;</div><div class="line">           @Override</div><div class="line">           public void onAnimationStart(Animator animation) &#123;</div><div class="line">               mStatus = Status.PRE;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationEnd(Animator animation) &#123;</div><div class="line">               mAngleAnim.cancel();</div><div class="line">               startAnimation(mTranslateAnim);</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationCancel(Animator animation) &#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationRepeat(Animator animation) &#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line"></div><div class="line">       animator.setDuration(mPreAnimDuration);</div><div class="line">       animator.setInterpolator(new LinearInterpolator());</div><div class="line">       mAngleAnim = animator;</div></pre></td></tr></table></figure></p>
<p>onDraw中绘制代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">if (mStatus == Status.PRE) &#123;</div><div class="line">          canvas.drawCircle(mWidth / 2f, mHeight / 2f, mHeight / 2f, mBgPaint);</div><div class="line">          canvas.save();</div><div class="line">          mTextPaint.setStyle(Paint.Style.FILL);</div><div class="line">          canvas.rotate(mAngle, mWidth / 2, mHeight / 2);</div><div class="line">          //大圆的圆心 半径</div><div class="line">          float cX = mWidth / 2f;</div><div class="line">          float cY = mHeight / 2f;</div><div class="line">          float radius = mHeight / 2 / 3f;</div><div class="line">          canvas.drawCircle(cX, cY, radius, mTextPaint);</div><div class="line">          //上方小圆的参数</div><div class="line">          float rr = radius / 2f;</div><div class="line">          float cYY = mHeight / 2 - (radius + rr / 3);</div><div class="line">          canvas.drawCircle(cX, cYY, rr, mTextPaint);</div><div class="line">          //左下小圆参数</div><div class="line">          float cXX = (float) (cX - Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          cYY = (float) (mHeight / 2 + Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          canvas.drawCircle(cXX, cYY, rr, mTextPaint);</div><div class="line">          //右下小圆参数</div><div class="line">          cXX = (float) (cX + Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          canvas.drawCircle(cXX, cYY, rr, mTextPaint);</div><div class="line">          canvas.restore();</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<h3 id="展开动画"><a href="#展开动画" class="headerlink" title="展开动画"></a>展开动画</h3><p>展开动画也是不断改变view的宽度并重绘圆角矩形，同时需要对准备动画的状态进行向右位移。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">Animation animator1 = new Animation() &#123;</div><div class="line">           @Override</div><div class="line">           protected void applyTransformation(float interpolatedTime, Transformation t) &#123;</div><div class="line">               mCurrLength = mHeight + (mWidth - mHeight) * interpolatedTime;</div><div class="line">               mTranslationX = (mWidth - mHeight) / 2 * interpolatedTime;</div><div class="line">               invalidate();</div><div class="line">           &#125;</div><div class="line">       &#125;;</div><div class="line">       animator1.setAnimationListener(new Animation.AnimationListener() &#123;</div><div class="line">           @Override</div><div class="line">           public void onAnimationStart(Animation animation) &#123;</div><div class="line">               mStatus = Status.EXPAND;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationEnd(Animation animation) &#123;</div><div class="line">               clearAnimation();</div><div class="line">               mLoadAngleAnim.start();</div><div class="line">               mMovePointAnim.start();</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationRepeat(Animation animation) &#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator1.setDuration(mExpandAnimDuration);</div><div class="line">       animator1.setInterpolator(new LinearInterpolator());</div><div class="line">       mTranslateAnim = animator1;</div></pre></td></tr></table></figure></p>
<p>onDraw中绘制代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">if (mStatus == Status.EXPAND) &#123;</div><div class="line">          float left = (mWidth - mCurrLength) / 2f;</div><div class="line">          float right = (mWidth + mCurrLength) / 2f;</div><div class="line">          float r = mHeight / 2f;</div><div class="line">          canvas.drawRoundRect(new RectF(left, 0, right, mHeight), r, r, mBgPaint);</div><div class="line">          canvas.save();</div><div class="line">          mTextPaint.setStyle(Paint.Style.FILL);</div><div class="line">          canvas.translate(mTranslationX, 0);</div><div class="line">          //大圆的圆心 半径</div><div class="line">          float cX = mWidth / 2f;</div><div class="line">          float cY = mHeight / 2f;</div><div class="line">          float radius = mHeight / 2 / 3f;</div><div class="line">          canvas.drawCircle(cX, cY, radius, mTextPaint);</div><div class="line">          //上方小圆的参数</div><div class="line">          float rr = radius / 2f;</div><div class="line">          float cYY = mHeight / 2 - (radius + rr / 3);</div><div class="line">          canvas.drawCircle(cX, cYY, rr, mTextPaint);</div><div class="line">          //左下小圆参数</div><div class="line">          float cXX = (float) (cX - Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          cYY = (float) (mHeight / 2 + Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          canvas.drawCircle(cXX, cYY, rr, mTextPaint);</div><div class="line">          //右下小圆参数</div><div class="line">          cXX = (float) (cX + Math.sqrt(2) / 2f * (radius + rr / 3f));</div><div class="line">          canvas.drawCircle(cXX, cYY, rr, mTextPaint);</div><div class="line">          canvas.restore();</div><div class="line">      &#125;</div></pre></td></tr></table></figure></p>
<h3 id="加载动画"><a href="#加载动画" class="headerlink" title="加载动画"></a>加载动画</h3><p>加载动画分三部分，右侧的旋转动画，正弦轨迹运动的小球动画，进度更新的动画。正弦动画要求出正弦函数的周期，y轴偏移量，x轴偏移量。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">ValueAnimator animator2 = ValueAnimator.ofFloat(0, 1);</div><div class="line">       animator2.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">           @Override</div><div class="line">           public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">               mLoadAngle += mLoadRotateAnimSpeed;</div><div class="line">               invalidate();</div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator2.addListener(new Animator.AnimatorListener() &#123;</div><div class="line">           @Override</div><div class="line">           public void onAnimationStart(Animator animation) &#123;</div><div class="line">               mStatus = Status.LOAD;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationEnd(Animator animation) &#123;</div><div class="line">               mLoadAngleAnim.cancel();</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationCancel(Animator animation) &#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line"></div><div class="line">           @Override</div><div class="line">           public void onAnimationRepeat(Animator animation) &#123;</div><div class="line"></div><div class="line">           &#125;</div><div class="line">       &#125;);</div><div class="line">       animator2.setDuration(Integer.MAX_VALUE);</div><div class="line">       animator2.setInterpolator(new LinearInterpolator());</div><div class="line">       mLoadAngleAnim = animator2;</div></pre></td></tr></table></figure></p>
<p>onDraw中绘制代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">if (mStatus == Status.LOAD || mStatus == Status.END) &#123;</div><div class="line">           float left = (mWidth - mCurrLength) / 2f;</div><div class="line">           float right = (mWidth + mCurrLength) / 2f;</div><div class="line">           float r = mHeight / 2f;</div><div class="line">           mBgPaint.setColor(mProgressColor);</div><div class="line">           canvas.drawRoundRect(new RectF(left, 0, right, mHeight), r, r, mBgPaint);</div><div class="line">           if (mProgress != 100) &#123;</div><div class="line">               for (int i = 0; i &lt; mFourMovePoints.length; i++) &#123;</div><div class="line">                   if (mFourMovePoints[i].isDraw)</div><div class="line">                       canvas.drawCircle(mFourMovePoints[i].moveX, mFourMovePoints[i].moveY, mFourMovePoints[i].radius, mTextPaint);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           float progressRight = mProgress * mWidth / 100f;</div><div class="line">           mBgPaint.setColor(mBgColor);</div><div class="line">           canvas.save();</div><div class="line">           canvas.clipRect(0, 0, progressRight, mHeight);</div><div class="line">           canvas.drawRoundRect(new RectF(left, 0, right, mHeight), r, r, mBgPaint);</div><div class="line">           canvas.restore();</div><div class="line"></div><div class="line">           if (mProgress != 100) &#123;</div><div class="line">               canvas.drawCircle(mWidth - mHeight / 2, mHeight / 2, mHeight / 2, mBgPaint);</div><div class="line">               canvas.save();</div><div class="line">               mTextPaint.setStyle(Paint.Style.FILL);</div><div class="line">               canvas.rotate(mLoadAngle, mWidth - mHeight / 2, mHeight / 2);</div><div class="line">               canvas.drawCircle(mWidth - mHeight + 30, getCenterY(mWidth - mHeight + 30, 5), 5, mTextPaint);</div><div class="line">               canvas.drawCircle(mWidth - mHeight + 45, getCenterY(mWidth - mHeight + 45, 8), 8, mTextPaint);</div><div class="line">               canvas.drawCircle(mWidth - mHeight + 68, getCenterY(mWidth - mHeight + 68, 11), 11, mTextPaint);</div><div class="line">               canvas.drawCircle(mWidth - mHeight + 98, getCenterY(mWidth - mHeight + 98, 14), 14, mTextPaint);</div><div class="line">               canvas.restore();</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           Paint.FontMetrics fm = mTextPaint.getFontMetrics();</div><div class="line">           float y = mHeight / 2 + (fm.descent - fm.ascent) / 2 - fm.descent;</div><div class="line">           canvas.drawText(mProgress + &quot;%&quot;, mWidth / 2, y, mTextPaint);</div><div class="line">       &#125;</div></pre></td></tr></table></figure></p>
<p>完整代码见<a href="https://github.com/Metal626/360DownLoadView" target="_blank" rel="external">GitHub</a>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="子质" />
            
              <p class="site-author-name" itemprop="name">子质</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/proton626" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/victheo" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.jianshu.com/users/ff6ebd9b5d53/latest_articles" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-globe"></i>简书</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">子质</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 102899, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/102899/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	
















  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("2ucjKGdyP0xa7iYGMIhItu0P-gzGzoHsz", "70zVy8rMInADux0z65ULdjR6");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
